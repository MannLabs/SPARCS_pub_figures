<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Code to Recreate all Figures &mdash; SPARCS_pub_figures 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/fonts.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Recreate Figures from SPARCSpy Manuscript" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            SPARCS_pub_figures
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Notebook</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Code to Recreate all Figures</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-1">2. Figure 1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-1C">2.1. Figure 1C</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-1D">2.2. Figure 1D</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-2">3. Figure 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-2A">3.1. Figure 2A</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-2D">3.2. Figure 2D</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-3">4. Figure 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-3A">4.1. Figure 3A</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-3C">4.2. Figure 3C</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-3D">4.3. Figure 3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-3E">4.4. Figure 3E</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-3F">4.5. Figure 3F</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-3G">4.6. Figure 3G</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-4">5. Figure 4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-4B">5.1. Figure 4B</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-4C">5.2. Figure 4C</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-4D">5.3. Figure 4D</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-4F">5.4. Figure 4F</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-4G">5.5. Figure 4G</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-4H">5.6. Figure 4H</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-5">6. Figure 5</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-5A">6.1. Figure 5A</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-5B">6.2. Figure 5B</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-5D">6.3. Figure 5D</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-5E">6.4. Figure 5E</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-S1">7. Figure S1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S1D">7.1. Figure S1D</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-S2">8. Figure S2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2B">8.1. Figure S2B</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2C">8.2. Figure S2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2D">8.3. Figure S2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2E">8.4. Figure S2E</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2F">8.5. Figure S2F</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2G">8.6. Figure S2G</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2H">8.7. Figure S2H</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2I">8.8. Figure S2I</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2J">8.9. Figure S2J</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2K">8.10. Figure S2K</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S2L">8.11. Figure S2L</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-S3">9. Figure S3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S3A">9.1. Figure S3A</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S3B">9.2. Figure S3B</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S3C">9.3. Figure S3C</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S3D">9.4. Figure S3D</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-S4">10. Figure S4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S4B">10.1. Figure S4B</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S4C">10.2. Figure S4C</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S4D">10.3. Figure S4D</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Figure-S5">11. Figure S5</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S5A">11.1. Figure S5A</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S5B">11.2. Figure S5B</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S5C">11.3. Figure S5C</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S5D">11.4. Figure S5D</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Figure-S5E">11.5. Figure S5E</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SPARCS_pub_figures</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">1. </span>Code to Recreate all Figures</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pages/notebooks/Plot_Figures_saved_data.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Code-to-Recreate-all-Figures">
<h1><span class="section-number">1. </span>Code to Recreate all Figures<a class="headerlink" href="#Code-to-Recreate-all-Figures" title="Link to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FormatStrFormatter</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">font_manager</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;pdf.fonttype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ps.fonttype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sans-serif&#39;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Helvetica Neue&#39;</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
             <span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
             <span class="s1">&#39;axes.titlesize&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
             <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
             <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">}</span>


<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">pylab</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="n">c1</span><span class="o">=</span><span class="s1">&#39;#B3262A&#39;</span>
<span class="n">c2</span><span class="o">=</span><span class="s1">&#39;#2f559a&#39;</span>
<span class="n">c3</span> <span class="o">=</span> <span class="s2">&quot;#FFFFFF&quot;</span>
<span class="n">cmap_classification_score</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;Prob_Unstim&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">c2</span><span class="p">,</span> <span class="n">c1</span><span class="p">],</span> <span class="n">N</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">cmap_unstim</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;Prob_Unstim&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">c3</span><span class="p">,</span> <span class="n">c1</span><span class="p">],</span> <span class="n">N</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">cmap_stim</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;Prob_Unstim&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">c3</span><span class="p">,</span> <span class="n">c2</span><span class="p">],</span> <span class="n">N</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="n">mm</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">2.54</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span>  <span class="c1"># mm in inches</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Figure-1">
<h1><span class="section-number">2. </span>Figure 1<a class="headerlink" href="#Figure-1" title="Link to this heading"></a></h1>
<section id="Figure-1C">
<h2><span class="section-number">2.1. </span>Figure 1C<a class="headerlink" href="#Figure-1C" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Raw_Data_LMD_cell_counting.csv&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">n_excised</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">n_excised</span><span class="p">]</span>

<span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_excised&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_excised</th>
      <th>Replicate</th>
      <th>n_counted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>100</td>
      <td>3.0</td>
      <td>79.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>500</td>
      <td>1.5</td>
      <td>387.5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">28</span>  <span class="o">*</span> <span class="n">mm</span><span class="p">,</span> <span class="mi">43</span> <span class="o">*</span> <span class="n">mm</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;n_excised&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;n_counted&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;n_counted&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;n_excised&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_excised&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>


<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;regions recovered&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;regionds excised&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/LMD_region_counts.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_5_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_5_0.png" />
</div>
</div>
</section>
<section id="Figure-1D">
<h2><span class="section-number">2.2. </span>Figure 1D<a class="headerlink" href="#Figure-1D" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Raw_Data_LMD_FACS_comparision_data.csv&quot;</span><span class="p">)</span>

<span class="c1">#convert to percent of selected cells</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;Mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Mean&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count per replicate&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;Std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Std&quot;</span><span class="p">]</span><span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count per replicate&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1">#get values for plotting</span>
<span class="n">plot_final</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;enrichment&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">plot_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)[</span><span class="s2">&quot;Mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">plot_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)[</span><span class="s2">&quot;Mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">plot_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)[</span><span class="s2">&quot;Mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

<span class="c1">#actually generate plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">28</span>  <span class="o">*</span> <span class="n">mm</span><span class="p">,</span> <span class="mi">43</span> <span class="o">*</span> <span class="n">mm</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">to_rgba</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">c2</span><span class="p">,</span> <span class="n">c1</span><span class="p">]</span>
<span class="n">colors_20per_alpha</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>

<span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">plot_final</span><span class="o">.</span><span class="n">enrichment</span><span class="p">,</span> <span class="n">plot_final</span><span class="o">.</span><span class="n">Mean</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span>  <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">colors_20per_alpha</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span> <span class="c1">#ecolor= [c2, c1]</span>

<span class="c1">#add error bars</span>
<span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">capthick</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">% s</span><span class="s2">gRNAs recovered&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LMD&quot;</span><span class="p">,</span> <span class="s2">&quot;FACS&quot;</span><span class="p">],</span> <span class="n">rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">45</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/FACS_LMD_comparision.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_7_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_7_0.png" />
</div>
</div>
</section>
</section>
<section id="Figure-2">
<h1><span class="section-number">3. </span>Figure 2<a class="headerlink" href="#Figure-2" title="Link to this heading"></a></h1>
<section id="Figure-2A">
<h2><span class="section-number">3.1. </span>Figure 2A<a class="headerlink" href="#Figure-2A" title="Link to this heading"></a></h2>
<p>Only the image region shown in this figure is deposited on Github. The complete imaging dataset with additional regions is deposited on Zenodo.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tifffile</span> <span class="kn">import</span> <span class="n">imread</span>

<span class="k">def</span> <span class="nf">colorize</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to create an RGB image from a single-channel image using a</span>
<span class="sd">    specific color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that we do just have a 2D image</span>
    <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This function expects a single-channel image!&#39;</span><span class="p">)</span>

    <span class="c1"># Rescale the image according to how we want to display it</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im_scaled</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Need to make sure we have a channels dimension for the multiplication to work</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">)</span>

    <span class="c1"># Reshape the color (here, we assume channels last)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">im_scaled</span> <span class="o">*</span> <span class="n">color</span>

<span class="k">def</span> <span class="nf">generate_composite</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

    <span class="n">colorized</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">colorize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">colorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorized</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">colorized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colorized</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">+=</span> <span class="n">colorized</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_percentile_norm</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">lower_value</span><span class="p">,</span> <span class="n">upper_value</span><span class="p">):</span>
    <span class="n">IPR</span> <span class="o">=</span> <span class="n">upper_value</span> <span class="o">-</span> <span class="n">lower_value</span>

    <span class="n">out_im</span> <span class="o">=</span> <span class="n">im</span> <span class="o">-</span> <span class="n">lower_value</span>
    <span class="n">out_im</span> <span class="o">=</span> <span class="n">out_im</span> <span class="o">/</span> <span class="n">IPR</span>
    <span class="n">out_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">out_im</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out_im</span>


<span class="c1">#generate overview for unstim</span>
<span class="n">image_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../data/example_imaged_100X_timecousre_LC3-mCherry/WT_Torin_Well2_tile10_ch2.tiff&quot;</span><span class="p">,</span>
              <span class="s2">&quot;../data/example_imaged_100X_timecousre_LC3-mCherry/WT_Torin_Well2_tile10_ch1.tiff&quot;</span><span class="p">,</span>
              <span class="s2">&quot;../data/example_imaged_100X_timecousre_LC3-mCherry/WT_Torin_Well2_tile10_ch3.tiff&quot;</span><span class="p">,</span>
             <span class="p">]</span>

<span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">im_path</span> <span class="ow">in</span> <span class="n">image_paths</span><span class="p">:</span>
    <span class="n">_im</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">im_path</span><span class="p">)</span>
    <span class="n">_im</span> <span class="o">=</span> <span class="n">_im</span>
    <span class="n">channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_im</span><span class="p">)</span>
<span class="n">channels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>

<span class="n">_images_stim</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">_im</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">550</span><span class="p">,</span> <span class="mi">180</span><span class="p">:</span><span class="mi">730</span><span class="p">]</span>
    <span class="n">_images_stim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_im</span><span class="p">)</span>
<span class="n">_images_stim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_images_stim</span><span class="p">)</span>

<span class="c1">#define timepoints we want to look at</span>
<span class="n">timepoints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<span class="n">_images_stim</span> <span class="o">=</span> <span class="n">_images_stim</span><span class="p">[</span><span class="n">timepoints</span><span class="p">,</span> <span class="p">:</span> <span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>

<span class="c1">#normalize all images to the range of the brightest image (to preserve relativ comparision)</span>
<span class="n">min_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">_img</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="k">for</span> <span class="n">_img</span> <span class="ow">in</span> <span class="n">_images_stim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">max_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">_img</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">)</span> <span class="k">for</span> <span class="n">_img</span> <span class="ow">in</span> <span class="n">_images_stim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

<span class="c1">#normalization needs to be</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_images_stim</span><span class="p">):</span>
    <span class="n">normed</span> <span class="o">=</span> <span class="p">[</span><span class="n">_percentile_norm</span><span class="p">(</span><span class="n">_img</span><span class="p">,</span> <span class="n">min_value</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">max_value</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">img</span><span class="p">)]</span>
    <span class="n">colorized</span> <span class="o">=</span> <span class="n">generate_composite</span><span class="p">(</span><span class="n">normed</span><span class="p">,</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">colorized</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timepoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">h&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normed</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normed</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">colorized</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timepoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">h&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normed</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normed</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;mCherry-LC3</span><span class="se">\n</span><span class="s2">membrane</span><span class="se">\n</span><span class="s2">nucelus&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">110</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;mCherry-LC3&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">110</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;membrane&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">110</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;nucelus&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">110</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Torin_stimulation_WT_cells_timecourse_100X.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_10_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_10_0.png" />
</div>
</div>
</section>
<section id="Figure-2D">
<h2><span class="section-number">3.2. </span>Figure 2D<a class="headerlink" href="#Figure-2D" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_A1_Raw_Data_Autophagy_Enrichment.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">to_rgba</span>

<span class="n">ATG5_color</span> <span class="o">=</span> <span class="s2">&quot;#B3262A&quot;</span>
<span class="n">autophagy_color</span> <span class="o">=</span> <span class="s2">&quot;#B3262A&quot;</span>
<span class="n">non_targeting_color</span> <span class="o">=</span> <span class="s2">&quot;#2F559A&quot;</span>

<span class="n">ATG5_values</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ATG5&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">non_targeting_controls</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">autophagy_values</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Autophagy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">median_ATG5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">ATG5_values</span><span class="p">)</span>
<span class="n">median_non_targeting_controls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">non_targeting_controls</span><span class="p">)</span>
<span class="n">median_autophagy_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">autophagy_values</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;values&quot;</span><span class="p">:</span><span class="n">ATG5_values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ATG5&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ATG5_values</span><span class="p">)}),</span>
              <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;values&quot;</span><span class="p">:</span><span class="n">autophagy_values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s2">&quot;labels&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Autophagy&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">autophagy_values</span><span class="p">)}),</span>
              <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;values&quot;</span><span class="p">:</span><span class="n">non_targeting_controls</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s2">&quot;labels&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">non_targeting_controls</span><span class="p">)})])</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">94</span> <span class="o">*</span> <span class="n">mm</span><span class="p">,</span> <span class="mi">47</span> <span class="o">*</span> <span class="n">mm</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">})</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;enrichment of gRNAs&quot;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">dodge</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
              <span class="n">palette</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ATG5&quot;</span><span class="p">:</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">ATG5_color</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">),</span> <span class="s2">&quot;Autophagy&quot;</span><span class="p">:</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">autophagy_color</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">),</span> <span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">:</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">non_targeting_color</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)},</span>
              <span class="n">edgecolors</span> <span class="o">=</span> <span class="p">[</span><span class="n">ATG5_color</span><span class="p">,</span> <span class="n">autophagy_color</span><span class="p">,</span> <span class="n">non_targeting_color</span><span class="p">],</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.25</span>
             <span class="p">)</span>

<span class="c1"># sns.swarmplot(df, x = &quot;values&quot;, y = &quot;labels&quot;, ax = axs, dodge = False, hue = &quot;labels&quot;, s = 3, linewidth = 0.25, fill = None)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;sgRNA target&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;fold enrichment of sgRNA in isolated cells over library&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">median_ATG5</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">ATG5_color</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">median_autophagy_values</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mf">1.4</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">autophagy_color</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">median_non_targeting_controls</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="mf">1.6</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mf">2.4</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">non_targeting_color</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="p">)</span>

<span class="c1">#adjust limits so that ticks end at edge of scale</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_A1_swarmplot_autophagy_genes.pdf&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/sophia/mambaforge-pypy3/envs/SPARCS/lib/python3.9/site-packages/seaborn/categorical.py:3544: UserWarning: 27.8% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.
  warnings.warn(msg, UserWarning)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_13_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_13_1.png" />
</div>
</div>
</section>
</section>
<section id="Figure-3">
<h1><span class="section-number">4. </span>Figure 3<a class="headerlink" href="#Figure-3" title="Link to this heading"></a></h1>
<section id="Figure-3A">
<h2><span class="section-number">4.1. </span>Figure 3A<a class="headerlink" href="#Figure-3A" title="Link to this heading"></a></h2>
<p>Only the cropped image regions shown in the figure are deposited in the GitHub Repository. The whole slide images for the shown training slides are deposited on zenodo.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tifffile</span> <span class="kn">import</span> <span class="n">imread</span>

<span class="k">def</span> <span class="nf">colorize</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to create an RGB image from a single-channel image using a</span>
<span class="sd">    specific color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that we do just have a 2D image</span>
    <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This function expects a single-channel image!&#39;</span><span class="p">)</span>

    <span class="c1"># Rescale the image according to how we want to display it</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im_scaled</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Need to make sure we have a channels dimension for the multiplication to work</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">)</span>

    <span class="c1"># Reshape the color (here, we assume channels last)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">im_scaled</span> <span class="o">*</span> <span class="n">color</span>

<span class="k">def</span> <span class="nf">generate_composite</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to generate a colorized overalyed image from multiple individual images</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colorized</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">colorize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">colorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorized</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">colorized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colorized</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">+=</span> <span class="n">colorized</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">37.5</span><span class="p">,</span> <span class="mi">28</span><span class="p">))</span>

<span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;../data/example_images_training_data/WT_Torin&quot;</span><span class="p">,</span>
          <span class="sa">f</span><span class="s2">&quot;../data/example_images_training_data/Library_Unstim&quot;</span><span class="p">,</span>
          <span class="sa">f</span><span class="s2">&quot;../data/example_images_training_data/ATG5_Torin&quot;</span>
         <span class="p">]</span>

<span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mCherryLC3&quot;</span><span class="p">,</span> <span class="s2">&quot;WGA488&quot;</span><span class="p">,</span> <span class="s2">&quot;Hoechst&quot;</span> <span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">image_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>

    <span class="n">image</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
        <span class="n">image</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_path</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">))</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">colorized</span> <span class="o">=</span> <span class="n">generate_composite</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">))</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">colorized</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>



<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mCherry-LC3&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;membrane&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hoechst&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mCherry-LC3</span><span class="se">\n</span><span class="s2">membrane</span><span class="se">\n</span><span class="s2">Hoechst&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>


<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;wt </span><span class="se">\n</span><span class="s2"> + Torin-1&quot;</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;ATG5-/- </span><span class="se">\n</span><span class="s2"> + Torin-1&quot;</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Classifier2_Example_Training_Data.pdf&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_16_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_16_0.png" />
</div>
</div>
</section>
<section id="Figure-3C">
<h2><span class="section-number">4.2. </span>Figure 3C<a class="headerlink" href="#Figure-3C" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;conv2d5&quot;</span><span class="p">,</span> <span class="s2">&quot;conv2d6&quot;</span><span class="p">,</span> <span class="s2">&quot;conv2d7&quot;</span><span class="p">,</span><span class="s2">&quot;conv2d8&quot;</span><span class="p">,</span><span class="s2">&quot;conv2d9&quot;</span><span class="p">,</span> <span class="s2">&quot;linear1&quot;</span><span class="p">,</span> <span class="s2">&quot;linear2&quot;</span><span class="p">,</span> <span class="s2">&quot;linear3&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>

    <span class="nb">input</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../data/classifier_2.1_Test_Data/UMAP_data/Raw_data_UMAP_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.csv&quot;</span>
    <span class="n">df_train_umap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

    <span class="n">outdir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../plots/UMAP_classifier2.1_layers/&quot;</span>

    <span class="c1">### Plot 1 Labels</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>


    <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;T_02_stim_Cr203_C6&#39;</span><span class="p">:</span><span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;T_02_stim_wt&quot;</span><span class="p">:</span><span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span>
                       <span class="s2">&quot;T_02_unstim_wt&quot;</span><span class="p">:</span><span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span>
                      <span class="p">})</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">df_train_umap</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">19</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;class_label&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">color_dict</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">ax1_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax1</span> <span class="o">=</span> <span class="n">ax1_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">)</span>
    <span class="n">cax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">cax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">(),</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="c1"># fig.tight_layout()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">/UMAP_test_data_labels_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>

    <span class="c1">### PLOT 2: prob unstim</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df_train_umap</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">19</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;prob_unstim&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">cmap_classification_score</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_classification_score</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>

    <span class="c1"># Remove the legend and add a colorbar</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">ax1_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax1</span> <span class="o">=</span> <span class="n">ax1_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">)</span>
    <span class="n">cb1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax1</span><span class="p">)</span>
    <span class="n">cax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">/UMAP_test_data_prob_unstim_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_2.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_3.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_4.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_5.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_6.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_7.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_8.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_9.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_10.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_11.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_12.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_12.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_13.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_13.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_14.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_14.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_18_15.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_18_15.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;conv2d8&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>

    <span class="nb">input</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../data/classifier_2.1_Test_Data/UMAP_data/Raw_data_UMAP_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.csv&quot;</span>
    <span class="n">df_train_umap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

    <span class="n">outdir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../plots/UMAP_classifier2.1_layers/&quot;</span>

    <span class="c1">### Plot 1 Labels</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>


    <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;T_02_stim_Cr203_C6&#39;</span><span class="p">:</span><span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;T_02_stim_wt&quot;</span><span class="p">:</span><span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span>
                       <span class="s2">&quot;T_02_unstim_wt&quot;</span><span class="p">:</span><span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span>
                      <span class="p">})</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">df_train_umap</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">19</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;class_label&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">color_dict</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">ax1_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax1</span> <span class="o">=</span> <span class="n">ax1_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">)</span>
    <span class="n">cax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">cax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">(),</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="c1"># fig.tight_layout()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">/UMAP_test_data_labels_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>

    <span class="c1">### PLOT 2: prob unstim</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df_train_umap</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">19</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;prob_unstim&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">cmap_classification_score</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_classification_score</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>

    <span class="c1"># Remove the legend and add a colorbar</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">ax1_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax1</span> <span class="o">=</span> <span class="n">ax1_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">)</span>
    <span class="n">cb1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax1</span><span class="p">)</span>
    <span class="n">cax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="c1"># fig.savefig(f&quot;{outdir}/UMAP_test_data_prob_unstim_{layer}.pdf&quot;, dpi = 500)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_19_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_19_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_19_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_19_1.png" />
</div>
</div>
</section>
<section id="Figure-3D">
<h2><span class="section-number">4.3. </span>Figure 3D<a class="headerlink" href="#Figure-3D" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/T02_Raw_Data_classifier_metrics_classifier_2.1_2.2.csv&quot;</span><span class="p">)</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_2.1&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>

<span class="n">results_all</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">auc_values</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
    <span class="n">true_label</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;stim&quot;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">fdr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">precision</span>

    <span class="n">auc_roc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
    <span class="n">auc_precision_recall</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="n">auc_values</span><span class="p">[</span><span class="n">version</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ROC&quot;</span><span class="p">:[</span><span class="n">auc_roc</span><span class="p">],</span> <span class="s2">&quot;precision_recall&quot;</span><span class="p">:[</span><span class="n">auc_precision_recall</span><span class="p">]})</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;false positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;true positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>
    <span class="n">auc_results</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.4g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auc_values</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">.</span><span class="n">ROC</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AUC = </span><span class="si">{</span><span class="n">auc_results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/T02_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_tpr_fpr_curve.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_21_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_21_0.png" />
</div>
</div>
</section>
<section id="Figure-3E">
<h2><span class="section-number">4.4. </span>Figure 3E<a class="headerlink" href="#Figure-3E" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/T02_Raw_Data_classifier_metrics_classifier_2.1_2.2.csv&quot;</span><span class="p">)</span>

<span class="n">slides</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unstim&quot;</span><span class="p">,</span> <span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;wt&quot;</span><span class="p">,</span> <span class="s2">&quot;wt + Torin-1&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5-/- + Torin-1&quot;</span><span class="p">]</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_2.1&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">slide</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slides</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="o">==</span> <span class="n">slide</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">])</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">cumulative</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cell count [%]&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;classification score&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/T02_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_Histogram_classifier_performance_lines.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_23_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_23_0.png" />
</div>
</div>
</section>
<section id="Figure-3F">
<h2><span class="section-number">4.5. </span>Figure 3F<a class="headerlink" href="#Figure-3F" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/T02_Raw_Data_classifier_metrics_classifier_2.1_2.2.csv&quot;</span><span class="p">)</span>

<span class="n">sample_label_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;unstim&quot;</span><span class="p">:</span><span class="s2">&quot;wt&quot;</span><span class="p">,</span> <span class="s2">&quot;stim&quot;</span><span class="p">:</span><span class="s2">&quot;wt + Torin-1&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">:</span><span class="s2">&quot;ATG5-/- + Torin-1&quot;</span><span class="p">}</span>

<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_2.1&quot;</span><span class="p">]</span>
<span class="n">n_cells</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">_df</span><span class="p">[</span><span class="s2">&quot;threshold_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_df</span><span class="p">[</span><span class="n">version</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.5</span>

    <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">threshold_label</span><span class="o">/</span><span class="n">n_cells</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">heatmap_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unstimulated&quot;</span><span class="p">]</span>
    <span class="n">heatmap_data</span><span class="p">[</span><span class="s2">&quot;stimulated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">heatmap_data</span><span class="o">.</span><span class="n">unstimulated</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wspace&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;hspace&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>

    <span class="n">cbar_ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
    <span class="n">cbar_ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">stimulated</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">),</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">cmap</span><span class="o">=</span> <span class="n">cmap_stim</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">% c</span><span class="s1">ells in class&#39;</span><span class="p">,</span> <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">},</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;.3g&quot;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax1</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">unstimulated</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">),</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">cmap</span><span class="o">=</span> <span class="n">cmap_unstim</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">},</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;.3g&quot;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax2</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>

    <span class="c1">#remove axis from second colorbar</span>
    <span class="n">cbar_ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="c1">#reassign labels into readable format</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_label_lookup</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get_text</span><span class="p">()]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()]</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;on&quot;</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;off&quot;</span><span class="p">])</span>

    <span class="c1">#move x-axis ticks to top and remove ticks</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1">#remove ylabel</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/T02_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_heatmap.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_2144530/59980073.py:50: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  fig.tight_layout()
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_25_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_25_1.png" />
</div>
</div>
</section>
<section id="Figure-3G">
<h2><span class="section-number">4.6. </span>Figure 3G<a class="headerlink" href="#Figure-3G" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/T02_Raw_Data_classifier_metrics_classifier_2.1_2.2.csv&quot;</span><span class="p">)</span>

<span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.99999</span><span class="p">,</span> <span class="mf">0.9999</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mf">0.9975</span><span class="p">,</span> <span class="mf">0.995</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.985</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.975</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">,</span> <span class="mf">0.965</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>

<span class="n">color1</span> <span class="o">=</span> <span class="s2">&quot;#B3262A&quot;</span>
<span class="n">color2</span> <span class="o">=</span> <span class="s2">&quot;#2f559a&quot;</span>

<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_2.1&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../data/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_Test_Data/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_precision_recall_data.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">results</span><span class="o">.</span><span class="n">precision</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color1</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">precision</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color1</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Precision [%]&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color1</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;classification threshold&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.96</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;classifier_2.2&#39;</span><span class="p">:</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;classifier_2.1&#39;</span><span class="p">:</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">98</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">))</span>

    <span class="c1"># twin object for two different y-axis on the sample plot</span>
    <span class="n">axs2</span><span class="o">=</span><span class="n">axs</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="c1"># make a plot with different y-axis using second axis object</span>
    <span class="n">axs2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">results</span><span class="o">.</span><span class="n">recall</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color2</span><span class="p">,</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axs2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">recall</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color2</span><span class="p">,</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">axs2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Recall [%]&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color2</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;classifier_2.2&#39;</span><span class="p">:</span>
        <span class="n">axs2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">91</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;classifier_2.1&#39;</span><span class="p">:</span>
        <span class="n">axs2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">axs2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1">#setting up X-axis label color to yellow</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color1</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color1</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color1</span><span class="p">)</span>

    <span class="n">axs2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color2</span><span class="p">)</span>
    <span class="n">axs2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
    <span class="n">axs2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color1</span><span class="p">)</span>
    <span class="n">axs2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color2</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/T02_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_Precision_recall_overlayed.pdf&quot;</span><span class="p">,</span>  <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_27_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_27_0.png" />
</div>
</div>
</section>
</section>
<section id="Figure-4">
<h1><span class="section-number">5. </span>Figure 4<a class="headerlink" href="#Figure-4" title="Link to this heading"></a></h1>
<section id="Figure-4B">
<h2><span class="section-number">5.1. </span>Figure 4B<a class="headerlink" href="#Figure-4B" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_umap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/Screen_B2_raw_data_UMAP.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">c1</span><span class="o">=</span><span class="s1">&#39;#B3262A&#39;</span>
<span class="n">c2</span><span class="o">=</span><span class="s1">&#39;#2f559a&#39;</span>
<span class="n">c3</span> <span class="o">=</span> <span class="s2">&quot;#FFFFFF&quot;</span>
<span class="n">cmap1</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;Prob_Unstim&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">c2</span><span class="p">,</span> <span class="n">c1</span><span class="p">],</span> <span class="n">N</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap1</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">df_umap</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span> <span class="s2">&quot;class_label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">16</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;prob_unstim&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Prob(Unstim)&quot;</span><span class="p">)</span>

<span class="c1"># Remove the legend and add a colorbar</span>
<span class="n">axs</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/Screen_B2_UMAP_classification_score_colored.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_30_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_30_0.png" />
</div>
</div>
</section>
<section id="Figure-4C">
<h2><span class="section-number">5.2. </span>Figure 4C<a class="headerlink" href="#Figure-4C" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/ScreenB2_raw_data_cell_classification_values_with_bin_annotation.parquet&quot;</span><span class="p">)</span>

<span class="n">bins</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bin1&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.99999</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
         <span class="s2">&quot;bin2&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.999</span><span class="p">,</span> <span class="mf">0.99999</span><span class="p">),</span>
         <span class="s2">&quot;bin3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9975</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">),</span>
         <span class="s2">&quot;bin4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.995</span><span class="p">,</span> <span class="mf">0.9975</span><span class="p">),</span>
         <span class="s2">&quot;bin5&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.995</span><span class="p">),</span>
         <span class="s2">&quot;bin6&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
        <span class="p">}</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span><span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span><span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span><span class="s2">&quot;#E46425&quot;</span><span class="p">,</span><span class="s2">&quot;#F5DB12&quot;</span><span class="p">,</span><span class="s2">&quot;#231F20&quot;</span><span class="p">,</span><span class="s2">&quot;#D1D3D4&quot;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">all_results</span><span class="o">.</span><span class="n">Prob_Unstim</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">histtype</span> <span class="o">=</span> <span class="s2">&quot;stepfilled&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cell count&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;classification score&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">hist</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">all_results</span><span class="o">.</span><span class="n">Prob_Unstim</span> <span class="o">&gt;=</span> <span class="mf">0.975</span><span class="p">]</span><span class="o">.</span><span class="n">Prob_Unstim</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">histtype</span> <span class="o">=</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cell count&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;classification score&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">_bin</span><span class="p">]</span>

    <span class="n">rectangle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">lower</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">upper</span><span class="o">-</span><span class="n">lower</span><span class="p">,</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">fc</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rectangle</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/ScreenB2_binning_strategy.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_32_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_32_0.png" />
</div>
</div>
</section>
<section id="Figure-4D">
<h2><span class="section-number">5.3. </span>Figure 4D<a class="headerlink" href="#Figure-4D" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_umap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/Screen_B2_raw_data_UMAP.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;bin1&#39;</span><span class="p">:</span><span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span>
                   <span class="s2">&quot;bin2&quot;</span><span class="p">:</span><span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;bin3&quot;</span><span class="p">:</span><span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;bin4&quot;</span><span class="p">:</span><span class="s2">&quot;#E46425&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;bin5&quot;</span><span class="p">:</span><span class="s2">&quot;#F5DB12&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;bin6&quot;</span><span class="p">:</span><span class="s2">&quot;#231F20&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;autophagy-on&quot;</span><span class="p">:</span><span class="s2">&quot;#D1D3D4&quot;</span>
                  <span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">df_umap</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span> <span class="s2">&quot;class_label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">16</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;class_label&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">color_dict</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/Screen_B2_UMAP_bins_colored.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_34_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_34_0.png" />
</div>
</div>
</section>
<section id="Figure-4F">
<h2><span class="section-number">5.4. </span>Figure 4F<a class="headerlink" href="#Figure-4F" title="Link to this heading"></a></h2>
<p>p-values were calculated in prism with the file /data/Screen_Analysis/zscore_pvalue_analysis.pzfx and added in illustrator</p>
<p>individual genes were annotated manually in illustrator on the basis of the interactive plots</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Sequencing_Analysis_gRNA_count_table.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

<span class="n">_plot</span> <span class="o">=</span> <span class="n">all_results</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_gene&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_results</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Enrichment&quot;</span><span class="p">)])</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_plot</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_gene&quot;</span><span class="p">]),</span> <span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">_plot</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_plot</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Enrichment&quot;</span><span class="p">)]],</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s2">&quot;omit&quot;</span><span class="p">)],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_gene&quot;</span><span class="p">])</span>

<span class="n">_plot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_plot</span><span class="o">.</span><span class="n">autophagy_gene</span><span class="p">,</span> <span class="s2">&quot;gene&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;01_autophagy_gene&quot;</span>
<span class="n">_plot</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;02_other&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;01_autophagy_gene&quot;</span><span class="p">,</span> <span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_plot</span><span class="o">.</span><span class="n">gene</span><span class="p">]</span>
<span class="n">_plot</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_plot</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span> <span class="n">_plot</span><span class="o">.</span><span class="n">gene</span><span class="p">)]</span>

<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;gene&quot;</span><span class="p">])</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="kn">import</span> <span class="nn">matplotlib.colors</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span> <span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span> <span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span> <span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span> <span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span> <span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span> <span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span> <span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span> <span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span> <span class="s2">&quot;#E46425&quot;</span><span class="p">,</span> <span class="s2">&quot;#E46425&quot;</span><span class="p">,</span> <span class="s2">&quot;#E46425&quot;</span><span class="p">,</span> <span class="s2">&quot;#F5DB12&quot;</span><span class="p">,</span> <span class="s2">&quot;#F5DB12&quot;</span><span class="p">,</span> <span class="s2">&quot;#F5DB12&quot;</span><span class="p">,</span> <span class="s2">&quot;#231F20&quot;</span><span class="p">,</span> <span class="s2">&quot;#231F20&quot;</span><span class="p">,</span> <span class="s2">&quot;#231F20&quot;</span><span class="p">]</span>
<span class="n">labels_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;enrichment_bin101_autophagy_gene&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin102_other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin1Non-Targeting Control&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin201_autophagy_gene&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin202_other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin2Non-Targeting Control&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin301_autophagy_gene&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin302_other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin3Non-Targeting Control&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin401_autophagy_gene&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin402_other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin4Non-Targeting Control&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin501_autophagy_gene&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin502_other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin5Non-Targeting Control&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin601_autophagy_gene&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin602_other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;enrichment_bin6Non-Targeting Control&#39;</span><span class="p">]</span>

<span class="n">labels_plot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;autophagy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;NTC&#39;</span><span class="p">,</span>
 <span class="s1">&#39;autophagy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;NTC&#39;</span><span class="p">,</span>
 <span class="s1">&#39;autophagy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;NTC&#39;</span><span class="p">,</span>
 <span class="s1">&#39;autophagy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;NTC&#39;</span><span class="p">,</span>
 <span class="s1">&#39;autophagy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;NTC&#39;</span><span class="p">,</span>
 <span class="s1">&#39;autophagy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;other&#39;</span><span class="p">,</span>
 <span class="s1">&#39;NTC&#39;</span><span class="p">]</span>

<span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels_data</span><span class="p">,</span> <span class="n">colors</span><span class="p">))</span>
<span class="n">label_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels_data</span><span class="p">,</span> <span class="n">labels_plot</span><span class="p">))</span>

<span class="c1"># ticks = [0, 1, 2, 3.5, 4.5, 5.5, 7, 8, 9, 10.5, 11.5,12.5, 14, 15, 16, 17.5, 18.5, 19.5]</span>
<span class="c1"># position_dict = dict(zip(label_dict.keys(), ticks))</span>
<span class="c1"># colors_dict = dict(zip(ticks, color_dict.values()))</span>
<span class="c1"># label_dict = dict(zip(ticks, label_dict.values()))</span>

<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="n">mm</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">2.54</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span>  <span class="c1"># mm in inches</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">64.65</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="mf">58.81</span><span class="o">*</span><span class="n">mm</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">flierprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">_plot</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">color_dict</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fliersize</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="n">flierprops</span> <span class="o">=</span> <span class="n">flierprops</span> <span class="p">)</span>

<span class="c1">#change color of fliers to max boxplot colors</span>
<span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">color_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">125</span><span class="p">]</span>

<span class="k">for</span> <span class="n">_id</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_children</span><span class="p">()[</span><span class="n">_id</span><span class="p">]</span>
    <span class="n">test</span><span class="o">.</span><span class="n">set_markeredgecolor</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">test</span><span class="o">.</span><span class="n">set_markerfacecolor</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="c1"># setup x and y-axis correctly</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;sgRNA enrichment relative to </span><span class="se">\n</span><span class="s2">input library [z-score per bin]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;sgRNA category&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

<span class="c1">#correct labels to annotate for plot readability</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label_dict</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get_text</span><span class="p">()]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>


<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/Zscores_of_enrichment_values.pdf&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_36_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_36_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># export wide dataframe for calculation of p-values in prism</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">all_results</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_gene&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_results</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Enrichment&quot;</span><span class="p">)])</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_plot</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_gene&quot;</span><span class="p">]),</span> <span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">_plot</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_plot</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Enrichment&quot;</span><span class="p">)]],</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s2">&quot;omit&quot;</span><span class="p">)],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">_plot</span><span class="p">[</span><span class="s2">&quot;gene_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_gene&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_id&quot;</span><span class="p">])</span>

<span class="n">_plot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_plot</span><span class="o">.</span><span class="n">autophagy_gene</span><span class="p">,</span> <span class="s2">&quot;gene&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;autophagy&quot;</span>
<span class="n">_plot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_plot</span><span class="o">.</span><span class="n">gene</span> <span class="o">==</span> <span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">,</span> <span class="s2">&quot;gene&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NTC&quot;</span>
<span class="n">_plot</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;other&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;autophagy&quot;</span><span class="p">,</span> <span class="s2">&quot;NTC&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_plot</span><span class="o">.</span><span class="n">gene</span><span class="p">]</span>
<span class="n">_plot</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;enrichment_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_plot</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span> <span class="n">_plot</span><span class="o">.</span><span class="n">gene</span><span class="p">)]</span>

<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;gene&quot;</span><span class="p">])</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">pivoted_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">_plot</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span> <span class="s2">&quot;gene_id&quot;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="n">pivoted_plot</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_zcores_of_enrichment_pvalue_calculation.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># labelling of individual genes was done manually in illustrator with interactive html plots as a guide</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
<span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="s1">&#39;iframe&#39;</span>

<span class="n">_plot</span> <span class="o">=</span> <span class="n">all_results</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_gene&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_results</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Enrichment&quot;</span><span class="p">)])</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_plot</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_gene&quot;</span><span class="p">]),</span> <span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">_plot</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_plot</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Enrichment&quot;</span><span class="p">)]],</span> <span class="n">nan_policy</span> <span class="o">=</span> <span class="s2">&quot;omit&quot;</span><span class="p">)],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">_plot</span><span class="p">[</span><span class="s2">&quot;gene_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_gene&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_id&quot;</span><span class="p">])</span>

<span class="n">_plot</span><span class="p">[</span><span class="s2">&quot;gene_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">gene</span>
<span class="n">_plot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_plot</span><span class="o">.</span><span class="n">autophagy_gene</span><span class="p">,</span> <span class="s2">&quot;gene_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;autophagy&quot;</span>
<span class="n">_plot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_plot</span><span class="o">.</span><span class="n">gene</span> <span class="o">==</span> <span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NTC&quot;</span>
<span class="n">_plot</span><span class="p">[</span><span class="s2">&quot;gene_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;other&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;autophagy&quot;</span><span class="p">,</span> <span class="s2">&quot;NTC&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_plot</span><span class="o">.</span><span class="n">gene_type</span><span class="p">]</span>
<span class="n">_plot</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;enrichment_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_plot</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span> <span class="n">_plot</span><span class="o">.</span><span class="n">gene_type</span><span class="p">)]</span>

<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_type&quot;</span><span class="p">])</span>
<span class="n">_plot</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">_plot</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">hover_name</span> <span class="o">=</span> <span class="s2">&quot;gene&quot;</span><span class="p">)</span>

<span class="n">order_axis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bin1_autophagy&#39;</span><span class="p">,</span> <span class="s1">&#39;bin1_other&#39;</span><span class="p">,</span> <span class="s1">&#39;bin1_NTC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bin2_autophagy&#39;</span><span class="p">,</span> <span class="s1">&#39;bin2_other&#39;</span><span class="p">,</span> <span class="s1">&#39;bin2_NTC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bin3_autophagy&#39;</span><span class="p">,</span> <span class="s1">&#39;bin3_other&#39;</span><span class="p">,</span> <span class="s1">&#39;bin3_NTC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bin4_autophagy&#39;</span><span class="p">,</span> <span class="s1">&#39;bin4_other&#39;</span><span class="p">,</span> <span class="s1">&#39;bin4_NTC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bin5_autophagy&#39;</span><span class="p">,</span> <span class="s1">&#39;bin5_other&#39;</span><span class="p">,</span> <span class="s1">&#39;bin5_NTC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bin6_autophagy&#39;</span><span class="p">,</span> <span class="s1">&#39;bin6_other&#39;</span><span class="p">,</span> <span class="s1">&#39;bin6_NTC&#39;</span><span class="p">]</span>
<span class="n">order_axis</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">categoryorder</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="n">categoryarray</span><span class="o">=</span> <span class="n">order_axis</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#save to html</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/interactive_Zscores_of_enrichment_values.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<iframe
    scrolling="no"
    width="100%"
    height="545px"
    src="iframe_figures/figure_20.html"
    frameborder="0"
    allowfullscreen
></iframe></div>
</div>
</section>
<section id="Figure-4G">
<h2><span class="section-number">5.5. </span>Figure 4G<a class="headerlink" href="#Figure-4G" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Sequencing_Analysis_gRNA_count_table.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">autophagy_genes_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Autophagy_Genes_list.txt&quot;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">to_rgba</span>

<span class="n">n_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="s2">&quot;bin1&quot;</span><span class="p">,</span> <span class="s2">&quot;bin2&quot;</span><span class="p">,</span> <span class="s2">&quot;bin3&quot;</span><span class="p">,</span> <span class="s2">&quot;bin4&quot;</span><span class="p">,</span> <span class="s2">&quot;bin5&quot;</span><span class="p">,</span> <span class="s2">&quot;bin6&quot;</span><span class="p">])</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span> <span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span> <span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span><span class="s2">&quot;#E46425&quot;</span><span class="p">,</span> <span class="s2">&quot;#F5DB12&quot;</span><span class="p">,</span>  <span class="s2">&quot;#231F20&quot;</span><span class="p">]</span>
<span class="n">colors_50per_alpha</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>
<span class="n">white</span> <span class="o">=</span> <span class="s2">&quot;#FFFFFF&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_plots</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">118.5</span> <span class="o">*</span> <span class="n">mm</span><span class="p">,</span> <span class="mi">220</span> <span class="o">*</span> <span class="n">mm</span><span class="p">),</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,)</span>
<span class="n">pivot_files</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">data_plots</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;bin1&quot;</span><span class="p">,</span> <span class="s2">&quot;bin2&quot;</span><span class="p">,</span> <span class="s2">&quot;bin3&quot;</span><span class="p">,</span> <span class="s2">&quot;bin4&quot;</span><span class="p">,</span> <span class="s2">&quot;bin5&quot;</span><span class="p">,</span> <span class="s2">&quot;bin6&quot;</span><span class="p">]):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">all_results</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;gRNA_names&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;depleted_gene&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gRNA_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gRNA.&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gRNA_names&quot;</span><span class="p">]]</span>

    <span class="n">_df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)])</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">data_plots</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_plots</span> <span class="o">=</span> <span class="n">_df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_plots</span> <span class="o">=</span> <span class="n">data_plots</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">_df</span><span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;outer&quot;</span><span class="p">)</span>

    <span class="n">_dat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span><span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">_dat</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">_dat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors_50per_alpha</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span> <span class="k">else</span> <span class="n">white</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>

    <span class="n">pivot_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;gRNA_names&#39;</span><span class="p">)</span>
    <span class="n">pivot_data</span> <span class="o">=</span> <span class="n">pivot_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labels</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">)</span>

    <span class="n">pivot_files</span><span class="p">[</span><span class="n">_bin</span><span class="p">]</span> <span class="o">=</span> <span class="n">pivot_data</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">);</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">pad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">pivot_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">pivot_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">pivot_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">);</span>
    <span class="c1">#make those ticks that correspond to autophagy genes bold</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span><span class="p">:</span>
            <span class="n">font_prop</span> <span class="o">=</span> <span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">weight</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
            <span class="n">label</span><span class="o">.</span><span class="n">set_fontproperties</span><span class="p">(</span><span class="n">font_prop</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/enrichment_bins.pdf&quot;</span><span class="p">,</span> <span class="n">transparent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_41_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_41_0.png" />
</div>
</div>
</section>
<section id="Figure-4H">
<h2><span class="section-number">5.6. </span>Figure 4H<a class="headerlink" href="#Figure-4H" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Sequencing_Analysis_gRNA_count_table.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">autophagy_genes_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Autophagy_Genes_list.txt&quot;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get genes to plot for heatmaa</span>
<span class="n">genes_df</span> <span class="o">=</span> <span class="n">all_results</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;ngRNAs_normCountsfiltered_bin1&quot;</span><span class="p">,</span> <span class="s2">&quot;ngRNAs_normCountsfiltered_bin2&quot;</span><span class="p">,</span> <span class="s2">&quot;ngRNAs_normCountsfiltered_bin3&quot;</span><span class="p">,</span> <span class="s2">&quot;ngRNAs_normCountsfiltered_bin4&quot;</span><span class="p">,</span> <span class="s2">&quot;ngRNAs_normCountsfiltered_bin5&quot;</span><span class="p">,</span> <span class="s2">&quot;ngRNAs_normCountsfiltered_bin6&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)</span>
<span class="n">genes_df</span> <span class="o">=</span> <span class="n">genes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">genes_df</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">genes_df</span>  <span class="o">=</span> <span class="n">genes_df</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">genes_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">())]</span>
<span class="n">genes_df</span> <span class="o">=</span> <span class="n">genes_df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">genes_df_filtered</span> <span class="o">=</span> <span class="n">genes_df</span><span class="p">[</span><span class="n">genes_df</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="n">genes_df_filtered</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gRNA_count&quot;</span><span class="p">]</span>
<span class="n">genes_to_plot</span> <span class="o">=</span> <span class="n">genes_df_filtered</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># heatmap visualization</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;bin1&quot;</span><span class="p">,</span> <span class="s2">&quot;bin2&quot;</span><span class="p">,</span> <span class="s2">&quot;bin3&quot;</span><span class="p">,</span> <span class="s2">&quot;bin4&quot;</span><span class="p">,</span> <span class="s2">&quot;bin5&quot;</span><span class="p">,</span> <span class="s2">&quot;bin6&quot;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">genes_to_plot</span><span class="p">):</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">all_results</span><span class="p">[</span><span class="n">all_results</span><span class="o">.</span><span class="n">gene</span> <span class="o">==</span> <span class="n">gene</span><span class="p">]</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">_df</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ngRNAs_nor&quot;</span><span class="p">)]))</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;bin1&quot;</span><span class="p">,</span> <span class="s2">&quot;bin2&quot;</span><span class="p">,</span> <span class="s2">&quot;bin3&quot;</span><span class="p">,</span> <span class="s2">&quot;bin4&quot;</span><span class="p">,</span> <span class="s2">&quot;bin5&quot;</span><span class="p">,</span> <span class="s2">&quot;bin6&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">values</span>
    <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;gene&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gene</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)</span>
<span class="n">indexes</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">indexes</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indexes</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">left</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">left</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">),</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">snap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]);</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">pad</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">left</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span> <span class="p">:</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span><span class="p">:</span>
        <span class="n">font_prop</span> <span class="o">=</span> <span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">weight</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontproperties</span><span class="p">(</span><span class="n">font_prop</span><span class="p">)</span>

<span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">results</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#D1D3D4&quot;</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;total sgRNAs&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">pad</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">left</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/heatmap_ngRNAS.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_45_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_45_0.png" />
</div>
</div>
</section>
</section>
<section id="Figure-5">
<h1><span class="section-number">6. </span>Figure 5<a class="headerlink" href="#Figure-5" title="Link to this heading"></a></h1>
<section id="Figure-5A">
<h2><span class="section-number">6.1. </span>Figure 5A<a class="headerlink" href="#Figure-5A" title="Link to this heading"></a></h2>
<p>enrichment values were calulcated in python and the enrichment value mapped to respective HEX color. The figure was then generated manually in illustrator.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Sequencing_Analysis_gRNA_count_table.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">autophagy_genes_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Autophagy_Genes_list.txt&quot;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">data_plots</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;bin1&quot;</span><span class="p">,</span> <span class="s2">&quot;bin2&quot;</span><span class="p">,</span> <span class="s2">&quot;bin3&quot;</span><span class="p">,</span> <span class="s2">&quot;bin4&quot;</span><span class="p">,</span> <span class="s2">&quot;bin5&quot;</span><span class="p">,</span> <span class="s2">&quot;bin6&quot;</span><span class="p">]):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">all_results</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;gRNA_names&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;depleted_gene&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gRNA_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gRNA.&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gRNA_names&quot;</span><span class="p">]]</span>

    <span class="n">_df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)])</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">data_plots</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_plots</span> <span class="o">=</span> <span class="n">_df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_plots</span> <span class="o">=</span> <span class="n">data_plots</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">_df</span><span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;outer&quot;</span><span class="p">)</span>


<span class="n">_values</span> <span class="o">=</span> <span class="n">data_plots</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">_to_export_kegg_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">_values</span><span class="p">)</span>
<span class="n">_to_export_kegg_plot</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;max_enrichment_bins&quot;</span><span class="p">]</span>
<span class="n">_to_export_kegg_plot</span><span class="p">[</span><span class="s2">&quot;max_enrichment_bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">_to_export_kegg_plot</span><span class="p">[</span><span class="s2">&quot;max_enrichment_bins&quot;</span><span class="p">])</span>
<span class="n">_to_export_kegg_plot</span> <span class="o">=</span> <span class="n">_to_export_kegg_plot</span><span class="p">[</span><span class="n">_to_export_kegg_plot</span><span class="o">.</span><span class="n">max_enrichment_bins</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">map_to_hex</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;Blues&quot;</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mpl_colors</span>

    <span class="n">minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
    <span class="n">maxima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">minima</span><span class="p">,</span> <span class="n">maxima</span><span class="p">)</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl_colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">minima</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maxima</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mapper</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapper</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpl_colors</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>


    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


    <span class="n">cb1</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span>
                                    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
    <span class="n">cb1</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;fold enrichment&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;colorbar_KEGG_enrichment.pdf&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

<span class="n">_to_export_kegg_plot</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">map_to_hex</span><span class="p">(</span><span class="n">_to_export_kegg_plot</span><span class="o">.</span><span class="n">max_enrichment_bins</span><span class="p">)</span>
<span class="n">_to_export_kegg_plot</span> <span class="o">=</span> <span class="n">_to_export_kegg_plot</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;max_enrichment_bins&quot;</span><span class="p">])</span>
<span class="n">_to_export_kegg_plot</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_enrichment_values_genes_autopahgy_pathway.tsv&quot;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.0 9.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_48_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_48_1.png" />
</div>
</div>
</section>
<section id="Figure-5B">
<h2><span class="section-number">6.2. </span>Figure 5B<a class="headerlink" href="#Figure-5B" title="Link to this heading"></a></h2>
<p>annotated gene labels were shifted in illustrator for better visibility</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Sequencing_Analysis_gRNA_count_table.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">autophagy_genes_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Autophagy_Genes_list.txt&quot;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#define size of circles to plot</span>
<span class="k">def</span> <span class="nf">scale_circle_size</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="n">lookup</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">lookup</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">lookup</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;bin1&quot;</span><span class="p">,</span> <span class="s2">&quot;bin2&quot;</span><span class="p">]):</span>


    <span class="n">df</span> <span class="o">=</span> <span class="n">all_results</span><span class="p">[</span><span class="n">all_results</span><span class="p">[</span><span class="s2">&quot;ngRNAs_&quot;</span><span class="o">+</span><span class="n">_bin</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">#only plot genes were we found at least 2 gRNAs</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">#manually set NTC gRNA numbre to 2 otherwise we would get very large dots for this</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>

    <span class="c1">#dynamically adjust x and y-axis limits according to data</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;normCounts_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;normCounts_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ymax</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">xmin</span><span class="o">/</span><span class="mf">0.000001</span><span class="p">)</span><span class="o">*</span><span class="mf">0.000001</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">xmax</span><span class="o">/</span><span class="mf">0.01</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="c1">#get autophagy genes to plot</span>
    <span class="n">autophagy_genes_list_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;EI24&quot;</span><span class="p">]</span> <span class="c1">#filter to remove EI24 since we will visualize in different color</span>
    <span class="n">autophagy_genes_list_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list_plot</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;ATG5&quot;</span><span class="p">]</span> <span class="c1">#filter to remove ATG5 since we will visualize in different color</span>
    <span class="n">_autophagy_genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list_plot</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

    <span class="c1">#subset data into non-autophagy related genes and autophagy-related genes</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_autophagy_genes</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_autophagy_genes</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;EI24&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span> <span class="p">:]</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;normCounts_&#39;</span> <span class="o">+</span> <span class="n">_bin</span><span class="p">),</span> <span class="n">df1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enrichment_&#39;</span> <span class="o">+</span> <span class="n">_bin</span><span class="p">),</span> <span class="n">s</span> <span class="o">=</span> <span class="n">scale_circle_size</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;gainsboro&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;normCounts_&#39;</span> <span class="o">+</span> <span class="n">_bin</span><span class="p">),</span> <span class="n">df2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enrichment_&#39;</span> <span class="o">+</span> <span class="n">_bin</span><span class="p">),</span> <span class="n">s</span> <span class="o">=</span> <span class="n">scale_circle_size</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;autophagy-related&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;EI24&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">df3</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;EI24&quot;</span><span class="p">]</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;normCounts_&#39;</span> <span class="o">+</span> <span class="n">_bin</span><span class="p">),</span> <span class="n">df3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enrichment_&#39;</span> <span class="o">+</span> <span class="n">_bin</span><span class="p">),</span> <span class="n">s</span> <span class="o">=</span> <span class="n">scale_circle_size</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;EI24&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;ATG5&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">df4</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ATG5&quot;</span><span class="p">]</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df4</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;normCounts_&#39;</span> <span class="o">+</span> <span class="n">_bin</span><span class="p">),</span> <span class="n">df4</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enrichment_&#39;</span> <span class="o">+</span> <span class="n">_bin</span><span class="p">),</span> <span class="n">s</span> <span class="o">=</span> <span class="n">scale_circle_size</span><span class="p">(</span><span class="n">df4</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#F58235&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;ATG5&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

    <span class="c1">#add annotation</span>
    <span class="n">df_annotate_write_out</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;normCounts_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0005</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;normCounts_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
    <span class="n">df_annotate_write_out</span> <span class="o">=</span> <span class="n">df_annotate_write_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_annotate_write_out</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span><span class="p">]]</span>
    <span class="n">df_annotate_write_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gene_annotation_enrichment_normCount_scatter_plot_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">.tsv&quot;</span><span class="p">)</span>

    <span class="n">df_annotate</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;normCounts_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.001</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">df_annotate</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span><span class="p">]</span>
    <span class="n">df_annotate</span> <span class="o">=</span> <span class="n">df_annotate</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labels</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">df_annotate</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;normCounts_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_annotate</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;enrichment_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;normalized counts&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;enrichment&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">_bin</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_data_ratio</span><span class="p">(),</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/scatterplot_gRNAs_enrichment_normcounts.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_51_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_51_0.png" />
</div>
</div>
</section>
<section id="Figure-5D">
<h2><span class="section-number">6.3. </span>Figure 5D<a class="headerlink" href="#Figure-5D" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load saved data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Raw_Data_EI24_timecourse_experiment.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">#groupby condition and calculate the mean for each replicate over all cells</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;well&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;timepoint&quot;</span><span class="p">,</span><span class="s1">&#39;region&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;replicate&quot;</span><span class="p">,</span> <span class="s2">&quot;Genotype&quot;</span><span class="p">,</span> <span class="s2">&quot;Condition&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">plot</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;replicate&quot;</span><span class="p">,</span> <span class="s2">&quot;Genotype&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span>

<span class="c1"># calculate the mean and SEM over the 3 biological replicates</span>
<span class="n">plot2</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Genotype&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">])[</span><span class="s2">&quot;Mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="n">plot2</span><span class="p">[</span><span class="s2">&quot;Sem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Genotype&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">])[</span><span class="s2">&quot;Mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
<span class="n">plot2</span> <span class="o">=</span> <span class="n">plot2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">genotype_color</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;WT_1&quot;</span><span class="p">:</span><span class="s2">&quot;#2F559A&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;WT_2&quot;</span><span class="p">:</span><span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span>
                  <span class="s1">&#39;EI24KO_1&#39;</span><span class="p">:</span><span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span>
                  <span class="s1">&#39;EI24KO_2&#39;</span><span class="p">:</span><span class="s2">&quot;#E46425&quot;</span><span class="p">,</span>
                 <span class="p">}</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">56</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="mi">58</span><span class="o">*</span><span class="n">mm</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="k">for</span> <span class="n">genotype</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">Genotype</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="n">plot2</span><span class="p">[</span><span class="n">plot2</span><span class="o">.</span><span class="n">Genotype</span> <span class="o">==</span> <span class="n">genotype</span><span class="p">]</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="n">_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">_data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">_data</span><span class="o">.</span><span class="n">Mean</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">genotype_color</span><span class="p">[</span><span class="n">genotype</span><span class="p">],</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">_data</span><span class="o">.</span><span class="n">Mean</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">genotype_color</span><span class="p">[</span><span class="n">genotype</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">genotype</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">_data</span><span class="o">.</span><span class="n">Mean</span> <span class="o">-</span> <span class="n">_data</span><span class="o">.</span><span class="n">Sem</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">_data</span><span class="o">.</span><span class="n">Mean</span> <span class="o">+</span> <span class="n">_data</span><span class="o">.</span><span class="n">Sem</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">_data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">lower</span> <span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">genotype_color</span><span class="p">[</span><span class="n">genotype</span><span class="p">],</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;classification score&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time [h]&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/EI24_timecourse.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_54_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_54_0.png" />
</div>
</div>
</section>
<section id="Figure-5E">
<h2><span class="section-number">6.4. </span>Figure 5E<a class="headerlink" href="#Figure-5E" title="Link to this heading"></a></h2>
<p>scale bars and arrows indicating specks were added manually in illustrator</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tifffile</span> <span class="kn">import</span> <span class="n">imread</span>

<span class="k">def</span> <span class="nf">colorize</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to create an RGB image from a single-channel image using a</span>
<span class="sd">    specific color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that we do just have a 2D image</span>
    <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This function expects a single-channel image!&#39;</span><span class="p">)</span>

    <span class="c1"># Rescale the image according to how we want to display it</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im_scaled</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Need to make sure we have a channels dimension for the multiplication to work</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">)</span>

    <span class="c1"># Reshape the color (here, we assume channels last)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">im_scaled</span> <span class="o">*</span> <span class="n">color</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">8.8</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">colorize</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;../data/example_images_100X_EI24_imaging/230224_U2OS_EI24_wt_Torin_0h.tif&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Wt&quot;</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">colorize</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;../data/example_images_100X_EI24_imaging/230224_U2OS_EI24_wt_Torin_14h.tif&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;14h&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">colorize</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;../data/example_images_100X_EI24_imaging/230224_U2OS_EI24_KO_Torin_0h.tif&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;EI24 -/-&quot;</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">colorize</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;../data/example_images_100X_EI24_imaging/230224_U2OS_EI24_KO_Torin_14h.tif&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/EI24_100X_images.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_56_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_56_0.png" />
</div>
</div>
</section>
</section>
<section id="Figure-S1">
<h1><span class="section-number">7. </span>Figure S1<a class="headerlink" href="#Figure-S1" title="Link to this heading"></a></h1>
<section id="Figure-S1D">
<h2><span class="section-number">7.1. </span>Figure S1D<a class="headerlink" href="#Figure-S1D" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read data on fraction of contaminating reads from background population</span>
<span class="n">data_excised</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/celltrace_enrichment/fraction_reference_reads.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">data_excised</span><span class="p">[</span><span class="s2">&quot;percentage_labelled_cells&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">data_excised</span><span class="o">.</span><span class="n">fraction_ref_reads</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># read data on fraction of celltrace positive slides contained on each slide</span>
<span class="n">data_slides</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/celltrace_enrichment/fraction_slides.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#define plotting function to generate donut plots</span>
<span class="k">def</span> <span class="nf">make_pie</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">startangle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="n">col</span> <span class="o">=</span> <span class="n">colors</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.45</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="n">startangle</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">outside</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                     <span class="n">textprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;white&quot;</span><span class="p">},</span>
                     <span class="n">wedgeprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">outside</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### generate plots for celltype distribution in input slides</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">data_slides</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;celltype&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1">#hela plot</span>
<span class="n">hela</span> <span class="o">=</span> <span class="n">means</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Hela&quot;</span><span class="p">,</span> <span class="s2">&quot;percentage_labelled_cells&quot;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">hela</span> <span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">hela</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;labelled&quot;</span><span class="p">,</span> <span class="s2">&quot;unlabelled&quot;</span><span class="p">]</span>

<span class="n">fig_hela</span> <span class="o">=</span> <span class="n">make_pie</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;library&quot;</span><span class="p">,[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">],</span><span class="n">label</span><span class="p">)</span>
<span class="n">fig_hela</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Donut_Hela_input_distribution.pdf&quot;</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="c1">#vero plot</span>
<span class="n">vero</span> <span class="o">=</span> <span class="n">means</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Vero&quot;</span><span class="p">,</span> <span class="s2">&quot;percentage_labelled_cells&quot;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">vero</span> <span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">vero</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;labelled&quot;</span><span class="p">,</span> <span class="s2">&quot;unlabelled&quot;</span><span class="p">]</span>

<span class="n">fig_vero</span> <span class="o">=</span> <span class="n">make_pie</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;library&quot;</span><span class="p">,[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">],</span><span class="n">label</span><span class="p">)</span>
<span class="n">fig_vero</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Donut_Vero_input_distribution.pdf&quot;</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_61_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_61_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_61_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_61_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### generate plots for excised cells</span>
<span class="n">means_excised</span> <span class="o">=</span> <span class="n">data_excised</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;celltype&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">percentage_labelled_cells</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">hela</span><span class="p">,</span> <span class="n">vero</span> <span class="o">=</span> <span class="n">means_excised</span>

<span class="c1">#hela plot</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">hela</span> <span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">hela</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;labelled&quot;</span><span class="p">,</span> <span class="s2">&quot;unlabelled&quot;</span><span class="p">]</span>
<span class="n">fig_hela_excised</span> <span class="o">=</span> <span class="n">make_pie</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;excised&quot;</span><span class="p">,[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">],</span><span class="n">label</span><span class="p">,</span> <span class="n">startangle</span> <span class="o">=</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">fig_hela_excised</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Donut_Hela_excised.pdf&quot;</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="c1">#vero plot</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">vero</span> <span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">vero</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;labelled&quot;</span><span class="p">,</span> <span class="s2">&quot;unlabelled&quot;</span><span class="p">]</span>
<span class="n">fig_vero_excised</span> <span class="o">=</span> <span class="n">make_pie</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;excised&quot;</span><span class="p">,[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">],</span><span class="n">label</span><span class="p">,</span> <span class="n">startangle</span> <span class="o">=</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">fig_vero_excised</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Donut_Vero_excised.pdf&quot;</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_62_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_62_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_62_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_62_1.png" />
</div>
</div>
</section>
</section>
<section id="Figure-S2">
<h1><span class="section-number">8. </span>Figure S2<a class="headerlink" href="#Figure-S2" title="Link to this heading"></a></h1>
<section id="Figure-S2B">
<h2><span class="section-number">8.1. </span>Figure S2B<a class="headerlink" href="#Figure-S2B" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Raw_Data_classifier_metrics_classifier_1.csv&quot;</span><span class="p">)</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_1&quot;</span><span class="p">]</span>

<span class="n">thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>

<span class="n">color1</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;negative&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;stim&quot;</span> <span class="k">else</span> <span class="s2">&quot;positive&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">_threshold</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;label_</span><span class="si">{</span><span class="n">_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;positive&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">_threshold</span> <span class="k">else</span> <span class="s2">&quot;negative&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">version</span><span class="p">]]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#to prevent dataframe fragmentation</span>

    <span class="c1">#precision = TP / (TP + FP)</span>

    <span class="k">for</span> <span class="n">_threshold</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
        <span class="n">true_label</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;label_</span><span class="si">{</span><span class="n">_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">TP</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">FP</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">TN</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">FN</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">tl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tl</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>
                    <span class="n">TP</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="s2">&quot;negative&quot;</span><span class="p">:</span>
                    <span class="n">FN</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">tl</span> <span class="o">==</span> <span class="s2">&quot;negative&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>
                    <span class="n">FP</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="s2">&quot;negative&quot;</span><span class="p">:</span>
                    <span class="n">TN</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="n">precision</span> <span class="o">=</span> <span class="n">TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FP</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="n">TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FN</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">TN</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FP</span> <span class="o">+</span> <span class="n">TN</span> <span class="o">+</span> <span class="n">FN</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">FPR</span> <span class="o">=</span> <span class="n">FP</span> <span class="o">/</span> <span class="p">(</span><span class="n">FP</span> <span class="o">+</span> <span class="n">TN</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">FDR</span> <span class="o">=</span> <span class="n">FP</span> <span class="o">/</span> <span class="p">(</span><span class="n">FP</span> <span class="o">+</span> <span class="n">TP</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_threshold</span><span class="p">,</span> <span class="s2">&quot;TP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TP</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_threshold</span><span class="p">,</span> <span class="s2">&quot;FP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FP</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_threshold</span><span class="p">,</span> <span class="s2">&quot;TN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TN</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_threshold</span><span class="p">,</span> <span class="s2">&quot;FN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FN</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_threshold</span><span class="p">,</span> <span class="s2">&quot;precision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_threshold</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_threshold</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accuracy</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_threshold</span><span class="p">,</span> <span class="s2">&quot;FPR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FPR</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_threshold</span><span class="p">,</span> <span class="s2">&quot;FDR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FDR</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#to prevent dataframe fragmentation</span>

    <span class="n">results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../data/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_Test_Data/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_FDR_data.csv&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">results</span><span class="o">.</span><span class="n">FDR</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color1</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">FDR</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color1</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;FDR [%]&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color1</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;classification </span><span class="se">\n</span><span class="s2">score cutoff&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;classifier_1&#39;</span><span class="p">:</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

    <span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_FDR.pdf&quot;</span><span class="p">,</span>  <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_65_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_65_0.png" />
</div>
</div>
</section>
<section id="Figure-S2C">
<h2><span class="section-number">8.2. </span>Figure S2C<a class="headerlink" href="#Figure-S2C" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Raw_Data_replicate_comparision_targeted_library.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sequence</th>
      <th>normalized_counts_A</th>
      <th>normalized_counts_B</th>
    </tr>
    <tr>
      <th>gene</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ATG10</th>
      <td>GCGACTGCTACAGGGACCAT</td>
      <td>7.406274e-02</td>
      <td>6.779847e-02</td>
    </tr>
    <tr>
      <th>ATG4B</th>
      <td>GGGGCTCACGGACATCAACG</td>
      <td>5.210339e-02</td>
      <td>4.546776e-02</td>
    </tr>
    <tr>
      <th>ATG7</th>
      <td>TCCGTGACCGTACCATGCAG</td>
      <td>5.200847e-02</td>
      <td>4.494161e-02</td>
    </tr>
    <tr>
      <th>ATG10</th>
      <td>ACAGACATGTCTTCCCATGG</td>
      <td>4.836661e-02</td>
      <td>4.685815e-02</td>
    </tr>
    <tr>
      <th>ATG3</th>
      <td>TAGTCCACCACTGTCCAACA</td>
      <td>3.530042e-02</td>
      <td>2.710795e-02</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>NLRP3</th>
      <td>AGAGATTGATCTCAATCTTG</td>
      <td>1.628812e-04</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>RBM12B</th>
      <td>CAGAGTCTTGAACATCACAA</td>
      <td>1.518706e-06</td>
      <td>1.625904e-04</td>
    </tr>
    <tr>
      <th>ADM2</th>
      <td>GGCTGCGGGACAGCGAGCCA</td>
      <td>3.796765e-07</td>
      <td>1.011829e-04</td>
    </tr>
    <tr>
      <th>TMEM39A</th>
      <td>AGAGGAAAGTGCCTCGACTG</td>
      <td>0.000000e+00</td>
      <td>7.477067e-04</td>
    </tr>
    <tr>
      <th>MAGEA5</th>
      <td>CCTCATGTCACATTAAGGCA</td>
      <td>0.000000e+00</td>
      <td>3.489065e-07</td>
    </tr>
  </tbody>
</table>
<p>221 rows × 3 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1">#dynamically adjust x and y-axis limits of plot according to data</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;normalized_counts_A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normalized_counts_B&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;normalized_counts_A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normalized_counts_B&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="o">/</span><span class="mf">0.01</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="o">/</span><span class="mf">0.01</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="p">)</span>

<span class="c1">#get autophagy genes to plot</span>
<span class="n">autophagy_genes_list_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;EI24&quot;</span><span class="p">]</span> <span class="c1">#filter to remove EI24 since we will visualize in different color</span>
<span class="n">autophagy_genes_list_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list_plot</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;ATG5&quot;</span><span class="p">]</span> <span class="c1">#filter to remove ATG5 since we will visualize in different color</span>
<span class="n">_autophagy_genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list_plot</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

<span class="c1">#subset data into non-autophagy related genes and autophagy-related genes</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_autophagy_genes</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_autophagy_genes</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;EI24&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span> <span class="p">:]</span>

<span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalized_counts_A&quot;</span><span class="p">),</span> <span class="n">df1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalized_counts_B&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;gainsboro&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalized_counts_A&quot;</span><span class="p">),</span> <span class="n">df2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalized_counts_B&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;autophagy-related&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="s2">&quot;EI24&quot;</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">df3</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;EI24&quot;</span><span class="p">]</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalized_counts_A&quot;</span><span class="p">),</span> <span class="n">df3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalized_counts_B&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;EI24&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="s2">&quot;ATG5&quot;</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">df4</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ATG5&quot;</span><span class="p">]</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df4</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalized_counts_A&quot;</span><span class="p">),</span> <span class="n">df4</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalized_counts_B&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#F58235&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;ATG5&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

<span class="c1"># Calculate the R-squared value</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
<span class="n">r_squared</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">normalized_counts_A</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">normalized_counts_B</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;normalized counts replicate 1&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;normalized counts replicate 2&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">axs</span><span class="o">.</span><span class="n">get_data_ratio</span><span class="p">(),</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="o">/</span><span class="mf">0.01</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span> <span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="o">/</span><span class="mf">0.01</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;R$^2$ = </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/Replicate_correlation_targeted_library.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9871717913360416
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_68_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_68_1.png" />
</div>
</div>
</section>
<section id="Figure-S2D">
<h2><span class="section-number">8.3. </span>Figure S2D<a class="headerlink" href="#Figure-S2D" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Raw_Data_classifier_metrics_classifier_1.csv&quot;</span><span class="p">)</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_1&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>

<span class="n">results_all</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">auc_values</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
    <span class="n">true_label</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;stim&quot;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">fdr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">precision</span>

    <span class="n">auc_roc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
    <span class="n">auc_precision_recall</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="n">auc_values</span><span class="p">[</span><span class="n">version</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ROC&quot;</span><span class="p">:[</span><span class="n">auc_roc</span><span class="p">],</span> <span class="s2">&quot;precision_recall&quot;</span><span class="p">:[</span><span class="n">auc_precision_recall</span><span class="p">]})</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;false positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;true positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>
    <span class="n">auc_results</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.4g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auc_values</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">.</span><span class="n">ROC</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AUC = </span><span class="si">{</span><span class="n">auc_results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_tpr_fpr_curve.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_70_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_70_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Raw_Data_classifier_metrics_classifier_1.csv&quot;</span><span class="p">)</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_1&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>

<span class="n">results_all</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">auc_values</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
    <span class="n">true_label</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;stim&quot;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">fdr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">precision</span>

    <span class="n">auc_roc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
    <span class="n">auc_precision_recall</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="n">auc_values</span><span class="p">[</span><span class="n">version</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ROC&quot;</span><span class="p">:[</span><span class="n">auc_roc</span><span class="p">],</span> <span class="s2">&quot;precision_recall&quot;</span><span class="p">:[</span><span class="n">auc_precision_recall</span><span class="p">]})</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;recall&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;precision&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_precision_recall_curve.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_71_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_71_0.png" />
</div>
</div>
</section>
<section id="Figure-S2E">
<h2><span class="section-number">8.4. </span>Figure S2E<a class="headerlink" href="#Figure-S2E" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Raw_Data_classifier_metrics_classifier_1.csv&quot;</span><span class="p">)</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_1&quot;</span><span class="p">]</span>

<span class="n">slides</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unstim&quot;</span><span class="p">,</span> <span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;wt&quot;</span><span class="p">,</span> <span class="s2">&quot;wt + Torin-1&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5-/- + Torin-1&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FormatStrFormatter</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">slide</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slides</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="o">==</span> <span class="n">slide</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">])</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">cumulative</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cell count [%]&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;classification score&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_Histogram_classifier_performance_lines.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_73_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_73_0.png" />
</div>
</div>
</section>
<section id="Figure-S2F">
<h2><span class="section-number">8.5. </span>Figure S2F<a class="headerlink" href="#Figure-S2F" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Raw_Data_classifier_metrics_classifier_1.csv&quot;</span><span class="p">)</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_1&quot;</span><span class="p">]</span>

<span class="n">sample_label_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;unstim&quot;</span><span class="p">:</span><span class="s2">&quot;wt&quot;</span><span class="p">,</span> <span class="s2">&quot;stim&quot;</span><span class="p">:</span><span class="s2">&quot;wt + Torin-1&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">:</span><span class="s2">&quot;ATG5-/- + Torin-1&quot;</span><span class="p">}</span>
<span class="n">n_cells</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">_df</span><span class="p">[</span><span class="s2">&quot;threshold_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_df</span><span class="p">[</span><span class="n">version</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.5</span>

    <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">threshold_label</span><span class="o">/</span><span class="n">n_cells</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">heatmap_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unstimulated&quot;</span><span class="p">]</span>
    <span class="n">heatmap_data</span><span class="p">[</span><span class="s2">&quot;stimulated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">heatmap_data</span><span class="o">.</span><span class="n">unstimulated</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wspace&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;hspace&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>

    <span class="n">cbar_ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
    <span class="n">cbar_ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">stimulated</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">),</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">cmap</span><span class="o">=</span> <span class="n">cmap_stim</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">% c</span><span class="s1">ells in class&#39;</span><span class="p">,</span> <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">},</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;.3g&quot;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax1</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">unstimulated</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">),</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">cmap</span><span class="o">=</span> <span class="n">cmap_unstim</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">},</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;.3g&quot;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax2</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>

    <span class="c1">#remove axis from second colorbar</span>
    <span class="n">cbar_ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="c1">#reassign labels into readable format</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_label_lookup</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get_text</span><span class="p">()]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()]</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;on&quot;</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;off&quot;</span><span class="p">])</span>

    <span class="c1">#move x-axis ticks to top and remove ticks</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1">#remove ylabel</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_heatmap.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_2144530/2736471724.py:49: UserWarning:

This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_75_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_75_1.png" />
</div>
</div>
</section>
<section id="Figure-S2G">
<h2><span class="section-number">8.6. </span>Figure S2G<a class="headerlink" href="#Figure-S2G" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;conv2d5&quot;</span><span class="p">,</span> <span class="s2">&quot;conv2d6&quot;</span><span class="p">,</span> <span class="s2">&quot;conv2d7&quot;</span><span class="p">,</span><span class="s2">&quot;conv2d8&quot;</span><span class="p">,</span><span class="s2">&quot;conv2d9&quot;</span><span class="p">,</span> <span class="s2">&quot;linear1&quot;</span><span class="p">,</span> <span class="s2">&quot;linear2&quot;</span><span class="p">,</span> <span class="p">]</span>

<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>

    <span class="nb">input</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../data/classifier_1_Test_Data/UMAP_data/Raw_data_UMAP_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.csv&quot;</span>
    <span class="n">df_train_umap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

    <span class="n">outdir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../plots/UMAP_classifier1_layers/&quot;</span>

    <span class="c1">### Plot 1 Labels</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>


    <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;ClassifierA_Cr203_C6&#39;</span><span class="p">:</span><span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;ClassifierA_test_stim&quot;</span><span class="p">:</span><span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span>
                       <span class="s2">&quot;ClassifierA_test_unstim&quot;</span><span class="p">:</span><span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span>
                      <span class="p">})</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">df_train_umap</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">19</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;class_label&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">color_dict</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">ax1_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax1</span> <span class="o">=</span> <span class="n">ax1_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">)</span>
    <span class="n">cax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">cax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">(),</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="c1"># fig.tight_layout()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">/UMAP_test_data_labels_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>

    <span class="c1">### PLOT 2: prob unstim</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df_train_umap</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">19</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;prob_unstim&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">cmap_classification_score</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_classification_score</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>

    <span class="c1"># Remove the legend and add a colorbar</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">ax1_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax1</span> <span class="o">=</span> <span class="n">ax1_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">)</span>
    <span class="n">cb1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax1</span><span class="p">)</span>
    <span class="n">cax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">/UMAP_test_data_prob_unstim_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_2.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_3.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_4.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_5.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_6.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_7.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_8.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_9.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_10.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_11.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_12.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_12.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_77_13.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_77_13.png" />
</div>
</div>
</section>
<section id="Figure-S2H">
<h2><span class="section-number">8.7. </span>Figure S2H<a class="headerlink" href="#Figure-S2H" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/T02_Raw_Data_classifier_metrics_classifier_2.1_2.2.csv&quot;</span><span class="p">)</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_2.1&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>

<span class="n">results_all</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">auc_values</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
    <span class="n">true_label</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;stim&quot;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">fdr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">precision</span>

    <span class="n">auc_roc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
    <span class="n">auc_precision_recall</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="n">auc_values</span><span class="p">[</span><span class="n">version</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ROC&quot;</span><span class="p">:[</span><span class="n">auc_roc</span><span class="p">],</span> <span class="s2">&quot;precision_recall&quot;</span><span class="p">:[</span><span class="n">auc_precision_recall</span><span class="p">]})</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;recall&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;precision&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/T02_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_precision_recall_curve.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_79_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_79_0.png" />
</div>
</div>
</section>
<section id="Figure-S2I">
<h2><span class="section-number">8.8. </span>Figure S2I<a class="headerlink" href="#Figure-S2I" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tifffile</span> <span class="kn">import</span> <span class="n">imread</span>
<span class="kn">from</span> <span class="nn">sparcscore.processing.preprocessing</span> <span class="kn">import</span> <span class="n">percentile_normalization</span>

<span class="k">def</span> <span class="nf">colorize</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to create an RGB image from a single-channel image using a</span>
<span class="sd">    specific color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that we do just have a 2D image</span>
    <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This function expects a single-channel image!&#39;</span><span class="p">)</span>

    <span class="c1"># Rescale the image according to how we want to display it</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im_scaled</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Need to make sure we have a channels dimension for the multiplication to work</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">)</span>

    <span class="c1"># Reshape the color (here, we assume channels last)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">im_scaled</span> <span class="o">*</span> <span class="n">color</span>

<span class="k">def</span> <span class="nf">generate_composite</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to generate a colorized overalyed image from multiple individual images</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colorized</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">colorize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">colorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorized</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">colorized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colorized</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">+=</span> <span class="n">colorized</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">channels_stim</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../data/golgi_classifiers/Hela_Noco.tif&quot;</span><span class="p">)</span>
<span class="n">channels_unstim</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../data/golgi_classifiers/Hela_unstim.tif&quot;</span><span class="p">)</span>

<span class="c1">#perform percentile normalization</span>
<span class="n">channels_stim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">percentile_normalization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.9999</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">channels_stim</span><span class="p">])</span>
<span class="n">channels_unstim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">percentile_normalization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.9999</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">channels_unstim</span><span class="p">])</span>

<span class="c1">#create composite image</span>
<span class="n">unstim_composite</span> <span class="o">=</span>  <span class="n">generate_composite</span><span class="p">(</span><span class="n">channels_unstim</span><span class="p">,</span> <span class="p">(</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">))</span>
<span class="n">stim_composite</span> <span class="o">=</span>  <span class="n">generate_composite</span><span class="p">(</span><span class="n">channels_stim</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">))</span>

<span class="c1">#plot figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">channels_unstim</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">channels_stim</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">unstim_composite</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">stim_composite</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">axis_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">,</span> <span class="s2">&quot;membrane&quot;</span><span class="p">,</span> <span class="s2">&quot;GM130&quot;</span><span class="p">,</span> <span class="s2">&quot;GM130</span><span class="se">\n</span><span class="s2">nuclei</span><span class="se">\n</span><span class="s2">membrane&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axis_labels</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">axis_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;Noco&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axis_labels</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">110</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/Golgi_classifiers/Noco_classifier_input_image_example.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_81_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_81_0.png" />
</div>
</div>
</section>
<section id="Figure-S2J">
<h2><span class="section-number">8.9. </span>Figure S2J<a class="headerlink" href="#Figure-S2J" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tifffile</span> <span class="kn">import</span> <span class="n">imread</span>
<span class="kn">from</span> <span class="nn">sparcscore.processing.preprocessing</span> <span class="kn">import</span> <span class="n">percentile_normalization</span>

<span class="k">def</span> <span class="nf">colorize</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to create an RGB image from a single-channel image using a</span>
<span class="sd">    specific color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that we do just have a 2D image</span>
    <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This function expects a single-channel image!&#39;</span><span class="p">)</span>

    <span class="c1"># Rescale the image according to how we want to display it</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">im_scaled</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">clip_percentile</span><span class="p">)</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Need to make sure we have a channels dimension for the multiplication to work</span>
    <span class="n">im_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">im_scaled</span><span class="p">)</span>

    <span class="c1"># Reshape the color (here, we assume channels last)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">im_scaled</span> <span class="o">*</span> <span class="n">color</span>

<span class="k">def</span> <span class="nf">generate_composite</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to generate a colorized overalyed image from multiple individual images</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colorized</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">colorize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">colorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorized</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">colorized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colorized</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">+=</span> <span class="n">colorized</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">channels_stim</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../data/golgi_classifiers/Hela_BFA.tif&quot;</span><span class="p">)</span>
<span class="n">channels_unstim</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../data/golgi_classifiers/Hela_unstim.tif&quot;</span><span class="p">)</span>

<span class="c1">#perform percentile normalization</span>
<span class="n">channels_stim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">percentile_normalization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.9999</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">channels_stim</span><span class="p">])</span>
<span class="n">channels_unstim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">percentile_normalization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.9999</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">channels_unstim</span><span class="p">])</span>

<span class="c1">#create composite image</span>
<span class="n">unstim_composite</span> <span class="o">=</span>  <span class="n">generate_composite</span><span class="p">(</span><span class="n">channels_unstim</span><span class="p">,</span> <span class="p">(</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">))</span>
<span class="n">stim_composite</span> <span class="o">=</span>  <span class="n">generate_composite</span><span class="p">(</span><span class="n">channels_stim</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">))</span>

<span class="c1">#plot figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">channels_unstim</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">channels_stim</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">unstim_composite</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">stim_composite</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">axis_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">,</span> <span class="s2">&quot;membrane&quot;</span><span class="p">,</span> <span class="s2">&quot;GM130&quot;</span><span class="p">,</span> <span class="s2">&quot;GM130</span><span class="se">\n</span><span class="s2">nuclei</span><span class="se">\n</span><span class="s2">membrane&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axis_labels</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">axis_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;BFA&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axis_labels</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">110</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/Golgi_classifiers/BFA_classifier_input_image_example.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_83_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_83_0.png" />
</div>
</div>
</section>
<section id="Figure-S2K">
<h2><span class="section-number">8.10. </span>Figure S2K<a class="headerlink" href="#Figure-S2K" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>

<span class="k">def</span> <span class="nf">generate_ROC_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">auc_roc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;false positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;true positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>
    <span class="n">auc_results</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.4g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auc_roc</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AUC = </span><span class="si">{</span><span class="n">auc_results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">generate_precision_recall_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>

    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">auc_precision_recall</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;recall&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;precision&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../data/golgi_classifiers/classification_metrics_Noco/classification_results_test_dataset.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">true_labels</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">labels</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">probs</span>

<span class="n">fig_roc</span> <span class="o">=</span> <span class="n">generate_ROC_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">fig_roc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/Golgi_classifiers/Noco_ROC_curve.pdf&quot;</span><span class="p">)</span>

<span class="n">fig_precision_recall</span> <span class="o">=</span> <span class="n">generate_precision_recall_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">fig_precision_recall</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/Golgi_classifiers/Noco_precision_recall_curve.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_85_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_85_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_85_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_85_1.png" />
</div>
</div>
</section>
<section id="Figure-S2L">
<h2><span class="section-number">8.11. </span>Figure S2L<a class="headerlink" href="#Figure-S2L" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>

<span class="k">def</span> <span class="nf">generate_ROC_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">auc_roc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;false positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;true positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>
    <span class="n">auc_results</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.4g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auc_roc</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AUC = </span><span class="si">{</span><span class="n">auc_results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">generate_precision_recall_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>

    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">auc_precision_recall</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;recall&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;precision&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../data/golgi_classifiers/classification_metrics_BFA/classification_results_test_dataset.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">true_labels</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">labels</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">probs</span>

<span class="n">fig_roc</span> <span class="o">=</span> <span class="n">generate_ROC_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">fig_roc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/Golgi_classifiers/BFA_ROC_curve.pdf&quot;</span><span class="p">)</span>

<span class="n">fig_precision_recall</span> <span class="o">=</span> <span class="n">generate_precision_recall_curve</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">fig_precision_recall</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/Golgi_classifiers/BFA_precision_recall_curve.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_87_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_87_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_87_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_87_1.png" />
</div>
</div>
</section>
</section>
<section id="Figure-S3">
<h1><span class="section-number">9. </span>Figure S3<a class="headerlink" href="#Figure-S3" title="Link to this heading"></a></h1>
<section id="Figure-S3A">
<h2><span class="section-number">9.1. </span>Figure S3A<a class="headerlink" href="#Figure-S3A" title="Link to this heading"></a></h2>
<p>Tables were formatted in illustrator</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># left table</span>

<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/ScreenB1_aggregated_results_number_of_cells_per_bin.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>cells imaged</th>
      <th>cells dissected</th>
      <th>percentage_of_all_cells</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bin1</td>
      <td>937</td>
      <td>795.0</td>
      <td>0.016915</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bin2</td>
      <td>10794</td>
      <td>9113.0</td>
      <td>0.194861</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bin3</td>
      <td>5021</td>
      <td>4387.0</td>
      <td>0.090643</td>
    </tr>
    <tr>
      <th>3</th>
      <td>bin4</td>
      <td>4540</td>
      <td>3968.0</td>
      <td>0.081959</td>
    </tr>
    <tr>
      <th>4</th>
      <td>bin5</td>
      <td>4839</td>
      <td>4270.0</td>
      <td>0.087357</td>
    </tr>
    <tr>
      <th>5</th>
      <td>bin6</td>
      <td>5121</td>
      <td>4525.0</td>
      <td>0.092448</td>
    </tr>
    <tr>
      <th>6</th>
      <td>cells &gt;= 0.98</td>
      <td>31252</td>
      <td>27058.0</td>
      <td>0.564183</td>
    </tr>
    <tr>
      <th>7</th>
      <td>all_imaged_cells</td>
      <td>5539333</td>
      <td>NaN</td>
      <td>100.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># right table</span>

<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/ScreenB2_aggregated_results_number_of_cells_per_bin.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>cells imaged</th>
      <th>cells dissected</th>
      <th>percentage_of_all_cells</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bin1</td>
      <td>19516</td>
      <td>14009.0</td>
      <td>0.056883</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bin2</td>
      <td>217766</td>
      <td>179898.0</td>
      <td>0.634718</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bin3</td>
      <td>74672</td>
      <td>52283.0</td>
      <td>0.217645</td>
    </tr>
    <tr>
      <th>3</th>
      <td>bin4</td>
      <td>56478</td>
      <td>41061.0</td>
      <td>0.164615</td>
    </tr>
    <tr>
      <th>4</th>
      <td>bin5</td>
      <td>55477</td>
      <td>41695.0</td>
      <td>0.161698</td>
    </tr>
    <tr>
      <th>5</th>
      <td>bin6</td>
      <td>56102</td>
      <td>43189.0</td>
      <td>0.163519</td>
    </tr>
    <tr>
      <th>6</th>
      <td>cells &gt;= 0.98</td>
      <td>480011</td>
      <td>372135.0</td>
      <td>1.399078</td>
    </tr>
    <tr>
      <th>7</th>
      <td>all_imaged_cells</td>
      <td>34309090</td>
      <td>NaN</td>
      <td>100.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Figure-S3B">
<h2><span class="section-number">9.2. </span>Figure S3B<a class="headerlink" href="#Figure-S3B" title="Link to this heading"></a></h2>
<p>slide names were removed and the slide batches annotated manually in illustrator</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/ScreenB1_raw_data_cell_classification_values_with_bin_annotation.parquet&quot;</span><span class="p">)</span>
<span class="n">_df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/ScreenB2_raw_data_cell_classification_values_with_bin_annotation.parquet&quot;</span><span class="p">)</span>

<span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_df1</span><span class="p">,</span> <span class="n">_df2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="n">all_results</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;slide&quot;</span><span class="p">,</span> <span class="s2">&quot;Prob_Unstim&quot;</span><span class="p">])</span>
<span class="n">data_cell_counts</span> <span class="o">=</span> <span class="n">all_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;slide&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">data_cell_counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;number_of_cells_per_slide&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">:</span><span class="mi">10</span> <span class="p">})</span>

<span class="n">axs</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">data_cell_counts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">data_cell_counts</span><span class="p">[</span><span class="s2">&quot;number_of_cells_per_slide&quot;</span><span class="p">],</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#D1D3D4&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_cell_counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())),</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_cell_counts</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">90</span><span class="p">);</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cells per slide&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;slidename&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_cell_counts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">350000</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis_number_of_cells_per_slide.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_95_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_95_0.png" />
</div>
</div>
</section>
<section id="Figure-S3C">
<h2><span class="section-number">9.3. </span>Figure S3C<a class="headerlink" href="#Figure-S3C" title="Link to this heading"></a></h2>
<p>median value was annotated manually in illustrator</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_reference_lysate.csv&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">[</span><span class="s2">&quot;normalized_counts_reference_cell_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot</span><span class="p">[</span><span class="s2">&quot;normalized_counts_reference&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">40620231</span><span class="c1">#multiply with the total number of cells imaged over 2.3 and 2.2 screen</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span><span class="p">[</span><span class="n">plot</span><span class="o">.</span><span class="n">gene</span> <span class="o">!=</span> <span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="s2">&quot;normalized_counts_reference_cell_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">);</span>
<span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="s2">&quot;normalized_counts_reference_cell_number&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">median</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="s2">&quot;normalized_counts_reference_cell_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gainsboro&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;all gRNAs&quot;</span><span class="p">)</span>

<span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">200</span><span class="p">)</span> <span class="o">*</span> <span class="mi">200</span>
<span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2000</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1400</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">median</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;number of cells / gene&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1400</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1400</span><span class="p">])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/histogram_n_cells_per_gene_complete_screen.pdf&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1818.6068774524556
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_97_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_97_1.png" />
</div>
</div>
</section>
<section id="Figure-S3D">
<h2><span class="section-number">9.4. </span>Figure S3D<a class="headerlink" href="#Figure-S3D" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference_lysate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_reference_lysate.csv&quot;</span><span class="p">)</span>

<span class="n">hist_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">reference_lysate</span><span class="p">[</span><span class="s2">&quot;normalized_counts_reference&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">hist_non_targeting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">reference_lysate</span><span class="p">[</span><span class="n">reference_lysate</span><span class="o">.</span><span class="n">gene</span> <span class="o">==</span> <span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">][</span><span class="s2">&quot;normalized_counts_reference&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))</span>
<span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#2f559a&quot;</span>
<span class="c1">#plot distribution of all gRNAs</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">hist_all</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gainsboro&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;all sgRNAs&quot;</span><span class="p">)</span>

<span class="c1">#adjust y-axis and x-axis limits of first y-axis</span>
<span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hist_all</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span>
<span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hist_all</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">0.00005</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.00005</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;fraction of reads&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">#duplicate x-axis and add second y-axis to plot non-targeting gRNAs to</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">hist_non_targeting</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hist_non_targeting</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;non-targeting </span><span class="se">\n</span><span class="s2">sgRNAs&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">)</span>

<span class="c1">#adjust y-axis limits of second y-axis and label correctly</span>
<span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hist_non_targeting</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;frequency non-targeting&quot;</span><span class="p">)</span>

<span class="c1">#change color of secondary y-axis</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">#create legend</span>
<span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">lines2</span><span class="p">,</span> <span class="n">labels2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">lines2</span><span class="p">,</span> <span class="n">labels</span> <span class="o">+</span> <span class="n">labels2</span><span class="p">,</span>  <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/histogram_gRNA_distribution_reference_lysate.pdf&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_99_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_99_0.png" />
</div>
</div>
</section>
</section>
<section id="Figure-S4">
<h1><span class="section-number">10. </span>Figure S4<a class="headerlink" href="#Figure-S4" title="Link to this heading"></a></h1>
<section id="Figure-S4B">
<h2><span class="section-number">10.1. </span>Figure S4B<a class="headerlink" href="#Figure-S4B" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_umap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/Screen_B1_raw_data_UMAP.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">c1</span><span class="o">=</span><span class="s1">&#39;#B3262A&#39;</span>
<span class="n">c2</span><span class="o">=</span><span class="s1">&#39;#2f559a&#39;</span>
<span class="n">c3</span> <span class="o">=</span> <span class="s2">&quot;#FFFFFF&quot;</span>
<span class="n">cmap1</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;Prob_Unstim&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">c2</span><span class="p">,</span> <span class="n">c1</span><span class="p">],</span> <span class="n">N</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap1</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">df_umap</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span> <span class="s2">&quot;class_label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">16</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;prob_unstim&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Prob(Unstim)&quot;</span><span class="p">)</span>

<span class="c1"># Remove the legend and add a colorbar</span>
<span class="n">axs</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/Screen_B1_UMAP_classification_score_colored.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_102_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_102_0.png" />
</div>
</div>
</section>
<section id="Figure-S4C">
<h2><span class="section-number">10.2. </span>Figure S4C<a class="headerlink" href="#Figure-S4C" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/ScreenB1_raw_data_cell_classification_values_with_bin_annotation.parquet&quot;</span><span class="p">)</span>

<span class="n">bins</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bin1&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.99999</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
         <span class="s2">&quot;bin2&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.999</span><span class="p">,</span> <span class="mf">0.99999</span><span class="p">),</span>
         <span class="s2">&quot;bin3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9975</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">),</span>
         <span class="s2">&quot;bin4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.995</span><span class="p">,</span> <span class="mf">0.9975</span><span class="p">),</span>
         <span class="s2">&quot;bin5&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.995</span><span class="p">),</span>
         <span class="s2">&quot;bin6&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
        <span class="p">}</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span><span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span><span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span><span class="s2">&quot;#E46425&quot;</span><span class="p">,</span><span class="s2">&quot;#F5DB12&quot;</span><span class="p">,</span><span class="s2">&quot;#231F20&quot;</span><span class="p">,</span><span class="s2">&quot;#D1D3D4&quot;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">all_results</span><span class="o">.</span><span class="n">Prob_Unstim</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">histtype</span> <span class="o">=</span> <span class="s2">&quot;stepfilled&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cell count&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;classification score&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">hist</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">all_results</span><span class="o">.</span><span class="n">Prob_Unstim</span> <span class="o">&gt;=</span> <span class="mf">0.975</span><span class="p">]</span><span class="o">.</span><span class="n">Prob_Unstim</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">histtype</span> <span class="o">=</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cell count&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;classification score&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">_bin</span><span class="p">]</span>

    <span class="n">rectangle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">lower</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">upper</span><span class="o">-</span><span class="n">lower</span><span class="p">,</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">fc</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rectangle</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/ScreenB1_binning_strategy.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_104_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_104_0.png" />
</div>
</div>
</section>
<section id="Figure-S4D">
<h2><span class="section-number">10.3. </span>Figure S4D<a class="headerlink" href="#Figure-S4D" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_umap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/screen_batches/Screen_B1_raw_data_UMAP.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;bin1&#39;</span><span class="p">:</span><span class="s1">&#39;#2f559a&#39;</span><span class="p">,</span>
                   <span class="s2">&quot;bin2&quot;</span><span class="p">:</span><span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;bin3&quot;</span><span class="p">:</span><span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;bin4&quot;</span><span class="p">:</span><span class="s2">&quot;#E46425&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;bin5&quot;</span><span class="p">:</span><span class="s2">&quot;#F5DB12&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;bin6&quot;</span><span class="p">:</span><span class="s2">&quot;#231F20&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;autophagy-on&quot;</span><span class="p">:</span><span class="s2">&quot;#D1D3D4&quot;</span>
                  <span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">df_umap</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span> <span class="s2">&quot;class_label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">16</span><span class="p">),</span>  <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;UMAP_1&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;UMAP_2&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;class_label&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">color_dict</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/Screen_Analysis/Screen_B1_UMAP_bins_colored.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_106_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_106_0.png" />
</div>
</div>
</section>
</section>
<section id="Figure-S5">
<h1><span class="section-number">11. </span>Figure S5<a class="headerlink" href="#Figure-S5" title="Link to this heading"></a></h1>
<section id="Figure-S5A">
<h2><span class="section-number">11.1. </span>Figure S5A<a class="headerlink" href="#Figure-S5A" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/T02_Raw_Data_classifier_metrics_classifier_2.1_2.2.csv&quot;</span><span class="p">)</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_2.2&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>

<span class="n">results_all</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">auc_values</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
    <span class="n">true_label</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;stim&quot;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">fdr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">precision</span>

    <span class="n">auc_roc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
    <span class="n">auc_precision_recall</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="n">auc_values</span><span class="p">[</span><span class="n">version</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ROC&quot;</span><span class="p">:[</span><span class="n">auc_roc</span><span class="p">],</span> <span class="s2">&quot;precision_recall&quot;</span><span class="p">:[</span><span class="n">auc_precision_recall</span><span class="p">]})</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;false positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;true positive rate&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>
    <span class="n">auc_results</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.4g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auc_values</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">.</span><span class="n">ROC</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AUC = </span><span class="si">{</span><span class="n">auc_results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/T02_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_tpr_fpr_curve.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_109_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_109_0.png" />
</div>
</div>
</section>
<section id="Figure-S5B">
<h2><span class="section-number">11.2. </span>Figure S5B<a class="headerlink" href="#Figure-S5B" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/T02_Raw_Data_classifier_metrics_classifier_2.1_2.2.csv&quot;</span><span class="p">)</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_2.2&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>

<span class="n">results_all</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">auc_values</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
    <span class="n">true_label</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;stim&quot;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">true_label</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">fdr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">precision</span>

    <span class="n">auc_roc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
    <span class="n">auc_precision_recall</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="n">auc_values</span><span class="p">[</span><span class="n">version</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ROC&quot;</span><span class="p">:[</span><span class="n">auc_roc</span><span class="p">],</span> <span class="s2">&quot;precision_recall&quot;</span><span class="p">:[</span><span class="n">auc_precision_recall</span><span class="p">]})</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;recall&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;precision&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/T02_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_precision_recall_curve.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_111_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_111_0.png" />
</div>
</div>
</section>
<section id="Figure-S5C">
<h2><span class="section-number">11.3. </span>Figure S5C<a class="headerlink" href="#Figure-S5C" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/T02_Raw_Data_classifier_metrics_classifier_2.1_2.2.csv&quot;</span><span class="p">)</span>

<span class="n">slides</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unstim&quot;</span><span class="p">,</span> <span class="s2">&quot;stim&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;wt&quot;</span><span class="p">,</span> <span class="s2">&quot;wt + Torin-1&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5-/- + Torin-1&quot;</span><span class="p">]</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_2.2&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FormatStrFormatter</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">slide</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slides</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="o">==</span> <span class="n">slide</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">version</span><span class="p">])</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">cumulative</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cell count [%]&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="mf">1.773</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;classification score&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/T02_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_Histogram_classifier_performance_lines.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_113_0.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_113_0.png" />
</div>
</div>
</section>
<section id="Figure-S5D">
<h2><span class="section-number">11.4. </span>Figure S5D<a class="headerlink" href="#Figure-S5D" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load previously saved data</span>
<span class="n">subsampled_classification_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/T02_Raw_Data_classifier_metrics_classifier_2.1_2.2.csv&quot;</span><span class="p">)</span>

<span class="n">sample_label_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;unstim&quot;</span><span class="p">:</span><span class="s2">&quot;wt&quot;</span><span class="p">,</span> <span class="s2">&quot;stim&quot;</span><span class="p">:</span><span class="s2">&quot;wt + Torin-1&quot;</span><span class="p">,</span> <span class="s2">&quot;ATG5_KO_Cr203_C6&quot;</span><span class="p">:</span><span class="s2">&quot;ATG5-/- + Torin-1&quot;</span><span class="p">}</span>

<span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier_2.2&quot;</span><span class="p">]</span>
<span class="n">n_cells</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">subsampled_classification_results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">_df</span><span class="p">[</span><span class="s2">&quot;threshold_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_df</span><span class="p">[</span><span class="n">version</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.5</span>

    <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">threshold_label</span><span class="o">/</span><span class="n">n_cells</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">heatmap_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unstimulated&quot;</span><span class="p">]</span>
    <span class="n">heatmap_data</span><span class="p">[</span><span class="s2">&quot;stimulated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">heatmap_data</span><span class="o">.</span><span class="n">unstimulated</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wspace&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;hspace&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>

    <span class="n">cbar_ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
    <span class="n">cbar_ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">stimulated</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">),</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">cmap</span><span class="o">=</span> <span class="n">cmap_stim</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">% c</span><span class="s1">ells in class&#39;</span><span class="p">,</span> <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">},</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;.3g&quot;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax1</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">unstimulated</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">),</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">cmap</span><span class="o">=</span> <span class="n">cmap_unstim</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">},</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;.3g&quot;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cbar_ax2</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>

    <span class="c1">#remove axis from second colorbar</span>
    <span class="n">cbar_ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="c1">#reassign labels into readable format</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_label_lookup</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get_text</span><span class="p">()]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()]</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;on&quot;</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;off&quot;</span><span class="p">])</span>

    <span class="c1">#move x-axis ticks to top and remove ticks</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1">#remove ylabel</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../plots/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/T02_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_heatmap.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_2144530/591137911.py:50: UserWarning:

This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_115_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_115_1.png" />
</div>
</div>
</section>
<section id="Figure-S5E">
<h2><span class="section-number">11.5. </span>Figure S5E<a class="headerlink" href="#Figure-S5E" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="c1">#read data</span>
<span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Sequencing_Analysis_gRNA_count_table.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">autophagy_genes_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/Screen_Analysis/Raw_Data_Autophagy_Genes_list.txt&quot;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1">#plot results for bin1 and bin2</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;bin1&quot;</span><span class="p">,</span> <span class="s2">&quot;bin2&quot;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">all_results</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;gRNA_names&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;normCounts_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_counts_reference&quot;</span><span class="p">,</span> <span class="s2">&quot;depleted_gene&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ngRNAs_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gRNA_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gRNA.&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gRNA_names&quot;</span><span class="p">]]</span>

    <span class="c1">#reduce list to only include sgRNAs that were sequenced</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;normCounts_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">tests_treatment</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)[</span><span class="sa">f</span><span class="s1">&#39;normCounts_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">tests_control</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)[</span><span class="sa">f</span><span class="s1">&#39;normalized_counts_reference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">tests_treatment</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">tests_control</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;indexes not the same!&quot;</span><span class="p">)</span>

    <span class="c1">#calculate p-values using one-tailed paired t-test for each of the genes found with at least 2gRNAs in each bin</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;p-value&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_treatment&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_control&quot;</span><span class="p">,</span> <span class="s2">&quot;log2FC&quot;</span><span class="p">,</span> <span class="s2">&quot;autophagy_status&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">gene</span><span class="p">,</span> <span class="n">values_control</span><span class="p">,</span> <span class="n">values_treatment</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tests_treatment</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">tests_control</span><span class="p">,</span> <span class="n">tests_treatment</span><span class="p">):</span>

        <span class="c1">#calculate p-value on log10 values per gene</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_rel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">values_treatment</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">values_control</span><span class="p">),</span>  <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;greater&#39;</span><span class="p">)</span>

        <span class="c1">#save results to dataframe</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span> <span class="s2">&quot;p-value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_value</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span> <span class="s2">&quot;mean_treatment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values_treatment</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span> <span class="s2">&quot;mean_control&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values_control</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span> <span class="s2">&quot;log2FC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values_treatment</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values_control</span><span class="p">))</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span> <span class="s2">&quot;autophagy_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span>
        <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span> <span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">p_value</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;number of tests performed in </span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tests_treatment</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1">#get non-targeting control cutoff</span>
    <span class="n">log2FC_control</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Non-Targeting Control&quot;</span><span class="p">,</span> <span class="s2">&quot;log2FC&quot;</span><span class="p">]</span>

    <span class="c1">#filter results to remove genes which showed a weaker enrichment than the non-targeting control</span>
    <span class="n">results_filtered</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">log2FC</span> <span class="o">&gt;</span> <span class="n">log2FC_control</span><span class="p">]</span>

    <span class="c1">#dynamically adjust x and y-axis limits of plot according to data</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log2FC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log2FC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ymax</span><span class="o">/</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">xmin</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">xmax</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">#get autophagy genes to plot</span>
    <span class="n">autophagy_genes_list_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;EI24&quot;</span><span class="p">]</span> <span class="c1">#filter to remove EI24 since we will visualize in different color</span>
    <span class="n">autophagy_genes_list_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list_plot</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;ATG5&quot;</span><span class="p">]</span> <span class="c1">#filter to remove ATG5 since we will visualize in different color</span>
    <span class="n">_autophagy_genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">autophagy_genes_list_plot</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

    <span class="c1">#subset data into non-autophagy related genes and autophagy-related genes</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_autophagy_genes</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_autophagy_genes</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;EI24&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span> <span class="p">:]</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log2FC&quot;</span><span class="p">),</span> <span class="n">df1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;gainsboro&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log2FC&quot;</span><span class="p">),</span> <span class="n">df2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#5AADC5&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;autophagy-related&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;EI24&quot;</span> <span class="ow">in</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">df3</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;EI24&quot;</span><span class="p">]</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log2FC&quot;</span><span class="p">),</span> <span class="n">df3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#F58235&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;EI24&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;ATG5&quot;</span> <span class="ow">in</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">df4</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ATG5&quot;</span><span class="p">]</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df4</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log2FC&quot;</span><span class="p">),</span> <span class="n">df4</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#B3262A&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;ATG5&quot;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

    <span class="c1">#add annotation</span>
    <span class="n">df_annotate_write_out</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">results_filtered</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;log2FC&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">results_filtered</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;log2FC&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;p-value&quot;</span><span class="p">])</span>
    <span class="n">df_annotate_write_out</span> <span class="o">=</span> <span class="n">df_annotate_write_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_annotate_write_out</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span><span class="p">]]</span>
    <span class="n">df_annotate_write_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../data/Screen_Analysis/gene_annotation_p_values_log2FC_scatterplot_</span><span class="si">{</span><span class="n">_bin</span><span class="si">}</span><span class="s2">.tsv&quot;</span><span class="p">)</span>

    <span class="n">df_annotate</span> <span class="o">=</span> <span class="n">results_filtered</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">results_filtered</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;log2FC&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">results_filtered</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">df_annotate</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">autophagy_genes_list</span><span class="p">]</span>
    <span class="n">df_annotate</span> <span class="o">=</span> <span class="n">df_annotate</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labels</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">df_annotate</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;log2FC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_annotate</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;-log10(p-value)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;log$_</span><span class="si">{2}</span><span class="s2">$FC&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;-log$_</span><span class="si">{10}</span><span class="s2">$p-value&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">_bin</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_data_ratio</span><span class="p">(),</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../plots/scatterplot_p_values_vs_log2FC.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
number of tests performed in bin1: 488
number of tests performed in bin2: 914
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/pages_notebooks_Plot_Figures_saved_data_117_1.png" src="../../_images/pages_notebooks_Plot_Figures_saved_data_117_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../index.html" class="btn btn-neutral float-left" title="Recreate Figures from SPARCSpy Manuscript" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sophia Maedler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>